import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,f as e,o as l}from"./app-D1IULfj1.js";const n={};function t(h,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="headscale" tabindex="-1"><a class="header-anchor" href="#headscale"><span>Headscale</span></a></h1><p>Headscale æ˜¯ä¸€æ¬¾å¼€æºè‡ªæ‰˜ç®¡çš„ Tailscale</p><h2 id="ä¸€ã€ç½‘ç»œä¸»æµå·¥å…·é€‰å‹å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ç½‘ç»œä¸»æµå·¥å…·é€‰å‹å¯¹æ¯”"><span>ä¸€ã€ç½‘ç»œä¸»æµå·¥å…·é€‰å‹å¯¹æ¯”</span></a></h2><blockquote><p>æ·±å…¥å­¦ä¹ <a href="https://headscale.net/stable/ref/configuration/" target="_blank" rel="noopener noreferrer">https://headscale.net/stable/ref/configuration/</a></p></blockquote><blockquote><p>Usage <a href="https://headscale.net/stable/usage/getting-started/" target="_blank" rel="noopener noreferrer">https://headscale.net/stable/usage/getting-started/</a> æœ¬èº«æ”¯æŒRemote CLIï¼Œé»˜è®¤æ— admin ç®¡ç†ç•Œé¢ï¼Œä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ã€‚</p></blockquote><blockquote><p>Headscale - Running headscale in a container <a href="https://headscale.net/stable/setup/install/container/" target="_blank" rel="noopener noreferrer">https://headscale.net/stable/setup/install/container/</a></p></blockquote><p>å¯¹æ¯”å¤šç§ç½‘ç»œæ‰“é€šæ–¹æ¡ˆï¼š<a href="https://mp.weixin.qq.com/s?__biz=MzI0NTU1MTA5MA==&amp;mid=2247487999&amp;idx=1&amp;sn=039bcccab192e995d7bd043f3f9c7802&amp;chksm=e873b0c5b672096d6cb4bf8bb36f6d1f36e5507ccf455d4a54fd77d62523e8b7eb4759fecaf7&amp;mpshare=1&amp;scene=1&amp;srcid=0715FpXD8A6SPB8ojte3TUQl&amp;sharer_shareinfo=b21aee4e622b53f4a17c0c8b45c78cc7&amp;sharer_shareinfo_first=b21aee4e622b53f4a17c0c8b45c78cc7#rd" target="_blank" rel="noopener noreferrer">é“¾æ¥åœ°å€</a></p><h3 id="ä¸»æµå·¥å…·æ¨ªå‘å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#ä¸»æµå·¥å…·æ¨ªå‘å¯¹æ¯”"><span><strong>ä¸»æµå·¥å…·æ¨ªå‘å¯¹æ¯”</strong></span></a></h3><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šè¡¨æ ¼ï¼Œè®©ä½ ä¸€ç›®äº†ç„¶ã€‚</p><table><thead><tr><th>ç‰¹æ€§</th><th>Easytier</th><th>ZeroTier / Tailscale</th><th>FRP / Natapp</th><th>Cloudflare Tunnel</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒåŸç†</strong></td><td>P2Pè™šæ‹Ÿå±€åŸŸç½‘</td><td>P2Pè™šæ‹Ÿå±€åŸŸç½‘</td><td>ç«¯å£è½¬å‘</td><td>ç«¯å£è½¬å‘/è™šæ‹Ÿç½‘ç»œ</td></tr><tr><td><strong>é…ç½®å¤æ‚åº¦</strong></td><td><strong>æä½</strong></td><td>ä½</td><td><strong>é«˜</strong></td><td>ä¸­ç­‰</td></tr><tr><td><strong>ä¾èµ–å…¬ç½‘IP</strong></td><td><strong>éœ€è¦ï¼ˆä½†å¯å…±ç”¨ï¼‰</strong></td><td>ä¸éœ€è¦</td><td><strong>éœ€è¦</strong></td><td>ä¸éœ€è¦</td></tr><tr><td><strong>ä¸­å¿ƒåŒ–ä¾èµ–</strong></td><td><strong>å®Œå…¨å»ä¸­å¿ƒåŒ–</strong></td><td><strong>ä¾èµ–å®˜æ–¹æ§åˆ¶å™¨</strong></td><td>è‡ªå»ºæœåŠ¡ç«¯ï¼ŒåŠä¸­å¿ƒåŒ–</td><td>ä¾èµ–Cloudflare</td></tr><tr><td><strong>å®‰å…¨æ€§/éšç§</strong></td><td><strong>æé«˜ï¼ˆæµé‡ç«¯åˆ°ç«¯åŠ å¯†ï¼‰</strong></td><td>é«˜ï¼ˆä¾èµ–å®˜æ–¹ï¼‰</td><td>ä¸­ç­‰ï¼ˆå–å†³äºè‡ªå·±é…ç½®ï¼‰</td><td>é«˜ï¼ˆä¾èµ–Cloudflareï¼‰</td></tr><tr><td><strong>ä½¿ç”¨åœºæ™¯</strong></td><td>ä¸ªäºº/å°å›¢é˜Ÿç§æœ‰ç½‘ç»œ</td><td>ä¸ªäºº/ä¼ä¸šçº§ä¾¿æ·ç»„ç½‘</td><td>å°†å†…ç½‘æœåŠ¡æš´éœ²åˆ°å…¬ç½‘</td><td>å°†æœåŠ¡æ¥å…¥CFç”Ÿæ€</td></tr><tr><td><strong>æˆ‘çš„è¯„ä»·</strong></td><td>ç®€å•ã€ç§å¯†ã€è‡ªç”±</td><td><strong>æœ€æ–¹ä¾¿</strong> ï¼Œä½†æœ‰æŸç¼š</td><td>åŠŸèƒ½å¼ºå¤§ï¼Œä½†<strong>å¤ªæŠ˜è…¾</strong></td><td>å…è´¹ç”¨æˆ·çš„ç¦éŸ³ï¼Œä½†æœ‰ç»‘å®š</td></tr></tbody></table><p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></p><ul><li>â€¢Â <strong>FRP</strong>ï¼šé€‚åˆéœ€è¦å°†æœåŠ¡ï¼ˆå¦‚ç½‘ç«™ï¼‰æ˜ç¡®æš´éœ²åˆ°å…¬ç½‘çš„åœºæ™¯ã€‚</li><li>â€¢Â <strong>ZeroTier/Tailscale</strong>ï¼šè¿½æ±‚æè‡´æ–¹ä¾¿ï¼Œä¸ä»‹æ„ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡çš„ä¸ªäººå’Œå›¢é˜Ÿé¦–é€‰ã€‚</li><li>â€¢Â <strong>Cloudflare Tunnel</strong>ï¼šå¦‚æœä½ å·²ç»æ˜¯Cloudflareç”¨æˆ·ï¼Œç”¨å®ƒæ•´åˆæœåŠ¡ä½“éªŒæä½³ã€‚</li><li>â€¢Â <strong>Easytier</strong>ï¼š<strong>æƒ³è¦ZeroTierçš„æ–¹ä¾¿ï¼Œåˆæƒ³è¦FRPçš„è‡ªä¸»å¯æ§ï¼Œé‚£ä¹ˆEasytierå°±æ˜¯ä¸ºä½ é‡èº«å®šåšçš„ã€‚</strong></li></ul><h2 id="äºŒã€æ‹“æ‰‘å›¾-tailscale" tabindex="-1"><a class="header-anchor" href="#äºŒã€æ‹“æ‰‘å›¾-tailscale"><span>äºŒã€æ‹“æ‰‘å›¾ Tailscale</span></a></h2><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-markdown"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            +-----------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            |      Headscale        |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | (Control Server)      |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | - ç”¨æˆ·è®¤è¯/ACLç®¡ç†    |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | - èŠ‚ç‚¹åè°ƒ            |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            +-----------+-----------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                        | (HTTPS API)</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                        |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">+------------------------+    +---------v---------+    +------------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">|      Node1-PC          |    |      DERP         |    |      Node3-VPS         |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| (Windows/Linux)        &lt;----+ (ä¸­ç»§æœåŠ¡å™¨)       +----&gt; (äº‘æœåŠ¡å™¨/å…¬ç½‘IP)     |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| - 100.xx.xx.xx         |    | - TCPæµé‡è½¬å‘      |    | - 100.xx.xx.xx         |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">| - å­ç½‘è·¯ç”±(å¯é€‰)       |    | - åŠ å¯†ç›²è½¬å‘       |    | - å‡ºå£èŠ‚ç‚¹(Exit Node)  |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">+------------------------+    +---------+---------+    +------------------------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                        |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                                        |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            +-----------v---------+</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            |      Node2-Mac      |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | (macOS/iOS)        |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | - 100.xx.xx.xx     |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            | - ç§»åŠ¨ç«¯è®¿é—®       |</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">                            +---------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="node-èŠ‚ç‚¹æ¸…å•" tabindex="-1"><a class="header-anchor" href="#node-èŠ‚ç‚¹æ¸…å•"><span>Node èŠ‚ç‚¹æ¸…å•</span></a></h3><p>Headscale æ³¨å†ŒæœåŠ¡</p><ul><li><code>tailscale up --login-server https://headscale.home:8443</code> â€”hostname=xxx</li><li>DERP: <a href="https://rerp.home:8443" target="_blank" rel="noopener noreferrer">https://rerp.home:8443</a></li></ul><p>Tailscale status</p><ul><li>100.64.0.1 desktop u03 windows</li><li>100.64.0.4 hk-vps u03 linux</li><li>100.64.0.5 office-pc u03 windows</li><li>100.64.0.6 imac u01 macOS</li></ul><h2 id="ä¸‰ã€å®¢æˆ·ç«¯å®‰è£…-tailscale" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€å®¢æˆ·ç«¯å®‰è£…-tailscale"><span>ä¸‰ã€å®¢æˆ·ç«¯å®‰è£… tailscale</span></a></h2><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-markdown"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">## Windows å®‰è£… - å¿…é¡»ä½¿ç”¨msi exeä¼šæŠ¥é”™</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">https://pkgs.tailscale.com/stable/tailscale-setup-1.86.0-amd64.msi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">## Linux å®‰è£…</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">curl -fsSL https://tailscale.com/install.sh | sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">## Mac å®‰è£… - æ‰‹åŠ¨å¼€å¯ tailscale å‘½ä»¤</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">## æ³¨å†ŒæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale up --login-server https://headscale.home.xxx.com/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">## ç½‘ç»œçŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale status</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale netcheck</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># ç®¡ç†å‘˜æƒé™</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Stop-Service Tailscale</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Start-Service Tailscale # å¼€å¯æœåŠ¡ï¼Œå¹¶ä¸”å¿…é¡»æ‰“å¼€ Tailscalå›¾å½¢ç•Œé¢ï¼Œå³ä¸‹è§’å°å›¾æ ‡ï¼</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># å…¶ä»–æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale logout</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale down</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å››ã€æœåŠ¡ç«¯æ“ä½œ-headscale" tabindex="-1"><a class="header-anchor" href="#å››ã€æœåŠ¡ç«¯æ“ä½œ-headscale"><span>å››ã€æœåŠ¡ç«¯æ“ä½œ headscale</span></a></h2><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-markdown"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">## æ“ä½œå‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">headscale users list</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">headscale users create u01</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">docker exec -it headscale headscale users create u01</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">docker exec -it headscale headscale nodes register --user u01 --key &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">docker exec -it headscale headscale preauthkeys create --user 1 --reusable --expiration 24h</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale up --login-server &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">YOUR_HEADSCALE_URL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; --authkey &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">YOUR_AUTH_KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">docker exec -it headscale headscale nodes list</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">docker exec -it headscale headscale nodes delete -i &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ID</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># Debug</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># æ£€æŸ¥æœåŠ¡çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">systemctl status tailscaled  # åº”ä¸º active (running)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># æŸ¥çœ‹å®æ—¶æ—¥å¿—</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">journalctl -u tailscaled -f</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># æµ‹è¯•èŠ‚ç‚¹è¿é€šæ€§</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">tailscale ping &lt;å¦ä¸€èŠ‚ç‚¹IP&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äº”ã€headscale-demo-æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#äº”ã€headscale-demo-æµ‹è¯•"><span>äº”ã€Headscale Demo æµ‹è¯•</span></a></h2><ul><li>Using packages for Debian/Ubuntu (recommended)</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Install</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">https://headscale.net/stable/setup/install/official/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Download - https://github.com/juanfont/headscale/releases/latest</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">HEADSCALE_VERSION</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0.26.1&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"> # See above URL for latest version, e.g. &quot;X.Y.Z&quot; </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">HEADSCALE_ARCH</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;amd64&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --output-document=headscale.deb</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;https://github.com/juanfont/headscale/releases/download/v</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">HEADSCALE_VERSION</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/headscale_</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">HEADSCALE_VERSION</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">_linux_</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">HEADSCALE_ARCH</span><span style="--shiki-light:#E45649;--shiki-dark:#98C379;">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.deb&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ./headscale.deb</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nano</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/headscale/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --now</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> headscale</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> headscale</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åªæµ‹è¯•é…ç½®ä»¥ä¸‹é€‰é¡¹ /etc/headscale/config.yaml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">server_url:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://47.76.253.98:8080</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">listen_addr:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 0.0.0.0:8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-markdown line-numbers-mode" data-highlighter="shiki" data-ext="markdown" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-markdown"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># Usage</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">https://headscale.net/stable/usage/getting-started/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">headscale users list</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">headscale users create &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">USER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># æ³¨å†Œæ–¹å¼ä¸€ Normal, interactive login</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client: tailscale up --login-server &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">YOUR_HEADSCALE_URL</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server: headscale nodes register --user &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">USER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt; --key &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">YOUR_MACHINE_KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"># æ³¨å†Œæ–¹å¼äºŒ Using a preauthkey</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server: headscale preauthkeys create --user &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">USER</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">client: tailscale up --login-server http://47.76.253.98:8080 --authkey &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">YOUR_AUTH_KEY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…­ã€é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#å…­ã€é—®é¢˜"><span>å…­ã€é—®é¢˜</span></a></h2><p><strong>é€€å‡ºç™»å½•å³æ–­å¼€è¿æ¥â€‹</strong>â€‹ï¼šTailscale å½“ç”¨æˆ·ä¸»åŠ¨é€€å‡ºç™»å½•ï¼ˆLog outï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šç«‹å³ç»ˆæ­¢ VPN è¿æ¥</p><ul><li>Tailscaleé…ç½®ä¸­ï¼Œå¼€å¯Run unattach é…ç½®å‹¾é€‰</li><li>è¿œç¨‹æ¡Œé¢æ–­å¼€åè‡ªåŠ¨å…³é—­ï¼šå¼ºåˆ¶ä¼šè¯è½¬ç§»åˆ°æ§åˆ¶å°ï¼ˆæœ¬åœ°ä¼šè¯ï¼‰ <ul><li><p>åœ¨è¿œç¨‹æ¡Œé¢è¿æ¥æ—¶ï¼Œé€šè¿‡CMDæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><p><code>query session# è·å–å½“å‰ä¼šè¯IDï¼ˆå¦‚ID=1ï¼‰</code></p><p><code>tscon 1 /dest:console# å°†ä¼šè¯1è½¬ç§»åˆ°æœ¬åœ°æ§åˆ¶å°</code></p></li><li><p><strong>åŸç†</strong>ï¼š<code>tscon</code>Â å‘½ä»¤å°†è¿œç¨‹ä¼šè¯æ— ç¼è½¬ç§»åˆ°æœ¬åœ°æ§åˆ¶å°ä¼šè¯ï¼Œä¿æŒæ‰€æœ‰è¿›ç¨‹è¿è¡Œï¼Œå³ä½¿æ–­å¼€è¿œç¨‹è¿æ¥ä¹Ÿä¸ä¼šç»ˆæ­¢</p></li></ul></li></ul><p><strong>/etc/default/tailscaled é…ç½®æ–‡ä»¶ä¸¢å¤±</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">/etc/default/tailscaled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> é…ç½®æ–‡ä»¶ä¸¢å¤±</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">å¯åŠ¨å‚æ•°éœ€è¦</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --port=</span><span style="--shiki-light:#E45649;--shiki-dark:#D19A66;">\${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#E45649;--shiki-dark:#D19A66;">}</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $FLAGS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> é»˜è®¤å€¼ï¼Ÿ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/usr/sbin/tailscaled</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> --state</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/var/lib/tailscale/tailscaled.state</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> --socket</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/run/tailscale/tailscaled.sock</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> --port</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">41641</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># /etc/default/tailscaled</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">41641</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # é»˜è®¤å€¼å¯çœç•¥</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">FLAGS</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;--login-server=http://your-headscale-ip:8080&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¸ƒã€headscale-æŠ€æœ¯æ–¹æ¡ˆä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä¸ƒã€headscale-æŠ€æœ¯æ–¹æ¡ˆä»‹ç»"><span>ä¸ƒã€Headscale æŠ€æœ¯æ–¹æ¡ˆä»‹ç»</span></a></h2><p>Headscale æ˜¯ä¸€æ¬¾å¼€æºè‡ªæ‰˜ç®¡çš„ Tailscale æ§åˆ¶æœåŠ¡å™¨å®ç°ï¼Œä¸“ä¸ºè¿½æ±‚ç§æœ‰åŒ–éƒ¨ç½²ã€æ•°æ®è‡ªä¸»å¯æ§çš„ç”¨æˆ·è®¾è®¡ã€‚ä»¥ä¸‹ä»æ ¸å¿ƒä»·å€¼ã€æŠ€æœ¯ç‰¹æ€§ã€éƒ¨ç½²æ–¹æ¡ˆã€åº”ç”¨åœºæ™¯ç­‰ç»´åº¦ç³»ç»Ÿè§£æå…¶æ–¹æ¡ˆè®¾è®¡ï¼š</p><hr><h3 id="ğŸ”§-ä¸€ã€æ ¸å¿ƒå®šä½ä¸ç§æœ‰åŒ–ä»·å€¼" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-ä¸€ã€æ ¸å¿ƒå®šä½ä¸ç§æœ‰åŒ–ä»·å€¼"><span>ğŸ”§ ä¸€ã€æ ¸å¿ƒå®šä½ä¸ç§æœ‰åŒ–ä»·å€¼</span></a></h3><ol><li><p><strong>Tailscale çš„æ›¿ä»£æ§åˆ¶é¢</strong></p><p>Headscale å®Œå…¨å¤åˆ» Tailscale æ§åˆ¶é¢é€»è¾‘ï¼Œå…¼å®¹å®˜æ–¹å®¢æˆ·ç«¯ï¼Œä½†å°†æ§åˆ¶æœåŠ¡å™¨ä» SaaS äº‘ç«¯è¿ç§»è‡³ç”¨æˆ·è‡ªæœ‰ç¯å¢ƒï¼Œå®ç°ï¼š</p><ul><li><strong>æ•°æ®ä¸»æƒ</strong>ï¼šæ‰€æœ‰èŠ‚ç‚¹æ³¨å†Œä¿¡æ¯ã€ACL ç­–ç•¥ã€é€šä¿¡çŠ¶æ€å‡å­˜å‚¨äºç§æœ‰æ•°æ®åº“ï¼ˆSQLite/PostgreSQLï¼‰ï¼›</li><li><strong>æ— è®¾å¤‡é™åˆ¶</strong>ï¼šå¼€æºç‰ˆæœ¬æ— è®¾å¤‡æ•°é‡æˆ–åŠŸèƒ½é™åˆ¶ï¼Œä¼ä¸šå¯è‡ªç”±æ‰©å±•ï¼›</li><li><strong>åè®®å…¼å®¹æ€§</strong>ï¼šåŸºäº WireGuard åè®®æ„å»ºç‚¹å¯¹ç‚¹åŠ å¯†éš§é“ï¼Œä¿ç•™é«˜æ•ˆç©¿é€ä¸ä½å»¶è¿Ÿç‰¹æ€§ã€‚</li></ul></li><li><p><strong>è§£å†³ SaaS ç—›ç‚¹</strong></p><p>é’ˆå¯¹ Tailscale å®˜æ–¹æœåŠ¡çš„ä¸è¶³ï¼š</p><ul><li><strong>åˆè§„æ€§</strong>ï¼šæ»¡è¶³é‡‘èã€æ”¿ä¼ç­‰åœºæ™¯çš„æœ¬åœ°åŒ–éƒ¨ç½²éœ€æ±‚ï¼›</li><li><strong>ç½‘ç»œä¼˜åŒ–</strong>ï¼šè‡ªå»º DERP ä¸­ç»§èŠ‚ç‚¹ï¼Œé¿å…è·¨å›½æµé‡ç»•è¡Œï¼ˆå¦‚å›½å†…è®¿é—®å®˜æ–¹èŠ‚ç‚¹å»¶è¿Ÿé«˜ï¼‰ï¼›</li><li><strong>è‡ªå®šä¹‰æ‰©å±•</strong>ï¼šæ”¯æŒä¸ LDAP/SSO é›†æˆã€è‡ªå®šä¹‰ ACL ç­–ç•¥ç­‰ã€‚</li></ul></li></ol><hr><h3 id="âš™ï¸-äºŒã€åŠŸèƒ½ç‰¹æ€§ä¸æŠ€æœ¯ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#âš™ï¸-äºŒã€åŠŸèƒ½ç‰¹æ€§ä¸æŠ€æœ¯ä¼˜åŠ¿"><span>âš™ï¸ äºŒã€åŠŸèƒ½ç‰¹æ€§ä¸æŠ€æœ¯ä¼˜åŠ¿</span></a></h3><table><thead><tr><th><strong>èƒ½åŠ›æ¨¡å—</strong></th><th><strong>å…³é”®ç‰¹æ€§</strong></th><th><strong>æŠ€æœ¯ä»·å€¼</strong></th></tr></thead><tbody><tr><td><strong>ç½‘ç»œæ¶æ„</strong></td><td>åŸºäº NAT ç©¿é€çš„ç½‘çŠ¶æ‹“æ‰‘ï¼ˆP2P ä¼˜å…ˆï¼Œä¸­ç»§å¤‡ç”¨ï¼‰</td><td>å‡å°‘ä¸­è½¬å¸¦å®½æˆæœ¬ï¼Œç›´è¿å»¶è¿Ÿä½è‡³ 10ms çº§</td></tr><tr><td><strong>è®¤è¯ä¸æƒé™</strong></td><td>æ”¯æŒé¢„æˆæƒå¯†é’¥ã€OIDC å•ç‚¹ç™»å½•ã€å¤šå‘½åç©ºé—´éš”ç¦»</td><td>çµæ´»å¯¹æ¥ä¼ä¸š IAM ç³»ç»Ÿï¼Œå®ç°ç§Ÿæˆ·éš”ç¦»</td></tr><tr><td><strong>ç­–ç•¥æ§åˆ¶</strong></td><td>ç²¾ç»†åŒ– ACL ç­–ç•¥ï¼ˆæŒ‰ IP/ç«¯å£/åè®®é™åˆ¶è®¿é—®ï¼‰ï¼ŒMagicDNS è‡ªåŠ¨åŸŸåè§£æ</td><td>æ›¿ä»£ä¼ ç»Ÿé˜²ç«å¢™è§„åˆ™ï¼ŒåŠ¨æ€ç®¡æ§è®¾å¤‡é€šä¿¡</td></tr><tr><td><strong>ä¸­ç»§æœåŠ¡</strong></td><td>å†…ç½®æˆ–è‡ªå»º DERP æœåŠ¡å™¨ï¼Œæ”¯æŒ UDP/TCP ä¸­ç»§</td><td>ç©¿é€ä¸¥æ ¼ NAT ç¯å¢ƒï¼Œæå‡è¿æ¥æˆåŠŸç‡</td></tr><tr><td><strong>è¿ç»´æ”¯æŒ</strong></td><td>é›†æˆ Prometheus ç›‘æ§ã€æ—¥å¿—å®¡è®¡ã€API é©±åŠ¨è‡ªåŠ¨åŒ–</td><td>ä¼ä¸šçº§å¯è§‚æµ‹æ€§ä¸è‡ªåŠ¨åŒ–è¿ç»´</td></tr></tbody></table><hr><h3 id="ğŸš€-ä¸‰ã€éƒ¨ç½²æ–¹æ¡ˆä¸å®è·µè·¯å¾„" tabindex="-1"><a class="header-anchor" href="#ğŸš€-ä¸‰ã€éƒ¨ç½²æ–¹æ¡ˆä¸å®è·µè·¯å¾„"><span>ğŸš€ ä¸‰ã€éƒ¨ç½²æ–¹æ¡ˆä¸å®è·µè·¯å¾„</span></a></h3><h4 id="_1-åŸºç¡€éƒ¨ç½²-äºŒè¿›åˆ¶-systemd" tabindex="-1"><a class="header-anchor" href="#_1-åŸºç¡€éƒ¨ç½²-äºŒè¿›åˆ¶-systemd"><span><strong>1. åŸºç¡€éƒ¨ç½²ï¼ˆäºŒè¿›åˆ¶/Systemdï¼‰</strong></span></a></h4><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå•æœåŠ¡å™¨å¿«é€Ÿéƒ¨ç½²</li><li><strong>æ­¥éª¤æ¦‚è¦</strong>ï¼š <ol><li>ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶å¹¶é…ç½®ï¼š</li></ol></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://github.com/juanfont/headscale/releases/download/v0.26.1/headscale_0.26.1_linux_amd64</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/bin/headscale</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/bin/headscale</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-åˆ›å»ºé…ç½®æ–‡ä»¶-etc-headscale-config-yaml-å…³é”®é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-åˆ›å»ºé…ç½®æ–‡ä»¶-etc-headscale-config-yaml-å…³é”®é…ç½®"><span>2. åˆ›å»ºé…ç½®æ–‡ä»¶ <code>/etc/headscale/config.yaml</code>ï¼Œå…³é”®é…ç½®ï¼š</span></a></h4><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-yaml"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">server_url</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">https://47.76.253.98</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # å…¬ç½‘è®¿é—®åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">listen_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">0.0.0.0:8080</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ip_prefixes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">100.64.0.0/10</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å®¢æˆ·ç«¯åˆ†é… IP æ®µ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">derp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  server</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    region_id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">999</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # è‡ªå®šä¹‰åŒºåŸŸ IDï¼ˆé¿å…ä¸å…¬å…± DERP å†²çªï¼‰</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    region_code</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;selfhosted&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    region_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Self-hosted DERP&quot;</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    stun_listen_addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0.0.0.0:3478&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # STUN æœåŠ¡ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    private_key_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/headscale/derp_private.key</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">noise</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  private_key_path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/headscale/noise_private.key</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # è‡ªåŠ¨ç”Ÿæˆå¯†é’¥æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">dns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  magic_dns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # å¯ç”¨ MagicDNS</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  base_domain</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;my.local&quot;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æ›¿æ¢ä¸ºä½ çš„ç§æœ‰åŸŸååç¼€</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  override_local_dns</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  nameservers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    global</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;1.1.1.1&quot;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;8.8.8.8&quot;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¿…é¡»é…ç½®çš„ IP åœ°å€æ± </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">prefixes</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  v4</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">100.64.0.0/10</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">         # IPv4 åœ°å€æ®µï¼ˆå¿…é€‰ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # v6: fd7a:115c:a1e0::/48 # å¯é€‰ IPv6 æ®µ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">allocation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sequential</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      # IP åˆ†é…ç­–ç•¥ï¼ˆsequential æˆ– randomï¼‰</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">database</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">sqlite</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æˆ– postgres</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  sqlite</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    path</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/opt/jupyter-lab/headscale/db.sqlite</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # SQLite æ•°æ®åº“æ–‡ä»¶è·¯å¾„</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-é€šè¿‡-systemd-æ‰˜ç®¡æœåŠ¡ã€‚" tabindex="-1"><a class="header-anchor" href="#_3-é€šè¿‡-systemd-æ‰˜ç®¡æœåŠ¡ã€‚"><span>3. é€šè¿‡ Systemd æ‰˜ç®¡æœåŠ¡ã€‚</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> users</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> users</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> u01</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">å…¶ä»–æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨é¢„æˆæƒå¯†é’¥â€‹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ä¸ºé¿å…æ‰‹åŠ¨æ³¨å†Œï¼Œå¯ç”Ÿæˆé¢„æˆæƒå¯†é’¥ï¼ˆé€‚åˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼‰ï¼š</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> preauthkeys</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">å®¢æˆ·ç«¯ç›´æ¥é€šè¿‡å¯†é’¥è¿æ¥ï¼šæ­¤æ–¹å¼æ— éœ€æ‰‹åŠ¨æ‰§è¡Œ</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> register</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> å‘½ä»¤</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=http://47.76.253.98:8080</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --authkey</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 15f46f928e6d5b421c08608f42978253dab8dedc49c5bc8d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-å®¹å™¨åŒ–éƒ¨ç½²-docker-k8s" tabindex="-1"><a class="header-anchor" href="#_2-å®¹å™¨åŒ–éƒ¨ç½²-docker-k8s"><span><strong>2. å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker/K8sï¼‰</strong></span></a></h4><ul><li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šéœ€å¼¹æ€§æ‰©ç¼©å®¹æˆ–é›†æˆäº‘åŸç”Ÿä½“ç³»</li><li><strong>æ–¹æ¡ˆè¦ç‚¹</strong>ï¼š <ul><li><strong>Docker Compose</strong>ï¼šé…ç½®ç«¯å£æ˜ å°„ä¸æŒä¹…åŒ–å·ï¼›</li><li><strong>Kubernetes</strong>ï¼šé€šè¿‡ Ingress æš´éœ²æœåŠ¡ï¼Œç»“åˆ CSI å­˜å‚¨æ•°æ®åº“ï¼›</li><li><strong>Sealos ä¸€é”®éƒ¨ç½²</strong>ï¼šäº‘åŸç”Ÿåº”ç”¨æ¨¡æ¿ï¼Œ15 ç§’å®Œæˆéƒ¨ç½²ï¼ˆå«å¯è§†åŒ–æ§åˆ¶å°ï¼‰ã€‚</li></ul></li></ul><h4 id="_3-å®¢æˆ·ç«¯æ¥å…¥" tabindex="-1"><a class="header-anchor" href="#_3-å®¢æˆ·ç«¯æ¥å…¥"><span><strong>3. å®¢æˆ·ç«¯æ¥å…¥</strong></span></a></h4><ul><li><strong>å‘½ä»¤ç¤ºä¾‹ï¼ˆLinuxï¼‰</strong>ï¼š</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=http://</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">HEADSCALE_IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:8080</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --accept-dns=false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>è®¿é—®è¿”å›çš„ URL å®Œæˆæ³¨å†Œï¼Œæˆ–åœ¨ Headscale æ‰§è¡Œï¼š
</code></pre><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> register</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">å‘½åç©º</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">é—´&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">è®¾å¤‡å¯†</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">é’¥&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>è·¨å¹³å°æ”¯æŒ</strong>ï¼šWindows/macOS å®¢æˆ·ç«¯éœ€ä¿®æ”¹é…ç½®æŒ‡å‘è‡ªå»ºæœåŠ¡å™¨ï¼›Android/iOS éœ€ä¾§è½½ä¿®æ”¹ç‰ˆå®¢æˆ·ç«¯ã€‚</li></ul><p>Headscale å®¢æˆ·ç«¯çš„æ¥å…¥æ–¹æ³•å› æ“ä½œç³»ç»Ÿè€Œå¼‚ï¼Œä»¥ä¸‹æ˜¯ä¸»è¦å¹³å°çš„è¯¦ç»†æ­¥éª¤å’Œæ³¨æ„äº‹é¡¹ï¼š</p><hr><h3 id="_1-linux-å®¢æˆ·ç«¯æ¥å…¥" tabindex="-1"><a class="header-anchor" href="#_1-linux-å®¢æˆ·ç«¯æ¥å…¥"><span><strong>1. Linux å®¢æˆ·ç«¯æ¥å…¥</strong></span></a></h3><h4 id="æ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤"><span><strong>æ­¥éª¤</strong>ï¼š</span></a></h4><ol><li><strong>å®‰è£… Tailscale å®¢æˆ·ç«¯</strong></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://pkgs.tailscale.com/stable/tailscale_1.22.2_amd64.tgz</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # ä¸‹è½½å¯¹åº”ç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zxvf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscale_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">.tgz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscale_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/tailscale</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscale_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/tailscaled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/sbin/tailscaled</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +x</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/sbin/tailscaled</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>æ³¨å†ŒæœåŠ¡å¹¶å¯åŠ¨</strong></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscale_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/systemd/tailscaled.service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /lib/systemd/system/</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --now</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscaled</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>è¿æ¥åˆ° Headscale æœåŠ¡å™¨</strong></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=http://</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">HEADSCALE_IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:8080</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --accept-dns=false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>- æ‰§è¡Œåä¼šç”Ÿæˆæ³¨å†Œé“¾æ¥ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å¹¶åœ¨ Headscale æœåŠ¡ç«¯æ‰§è¡Œç±»ä¼¼ä»¥ä¸‹å‘½ä»¤å®Œæˆæ³¨å†Œï¼š  
</code></pre><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> register</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">USERNAM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">E&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--key</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Y&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹"><span><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</span></a></h4><ul><li>è‹¥éœ€éäº¤äº’å¼æ³¨å†Œï¼Œå¯ä½¿ç”¨é¢„æˆæƒå¯†é’¥ï¼š</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=http://</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">HEADSCALE_IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:8080</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --authkey</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PREAUTH_KE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Y&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="_2-macos-å®¢æˆ·ç«¯æ¥å…¥" tabindex="-1"><a class="header-anchor" href="#_2-macos-å®¢æˆ·ç«¯æ¥å…¥"><span><strong>2. macOS å®¢æˆ·ç«¯æ¥å…¥</strong></span></a></h3><h4 id="æ­¥éª¤-1" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-1"><span><strong>æ­¥éª¤</strong>ï¼š</span></a></h4><ol><li><strong>å®‰è£… Tailscale å®¢æˆ·ç«¯</strong><ul><li>é€šè¿‡ <a href="https://tailscale.com/download%E4%B8%8B%E8%BD%BD" target="_blank" rel="noopener noreferrer">https://tailscale.com/downloadä¸‹è½½</a> macOS ç‰ˆå®‰è£…åŒ…ã€‚</li></ul></li><li><strong>ä¿®æ”¹å®¢æˆ·ç«¯é…ç½®</strong>ï¼ˆå¯é€‰ï¼‰ <ul><li>ç¼–è¾‘é…ç½®æ–‡ä»¶ <code>/etc/default/tailscaled</code>ï¼ŒæŒ‡å®š Headscale æœåŠ¡å™¨åœ°å€ã€‚</li></ul></li><li><strong>è¿æ¥ Headscale</strong></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=http://</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">HEADSCALE_IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">:8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>- åç»­æ“ä½œä¸ Linux ç±»ä¼¼ï¼Œéœ€åœ¨æœåŠ¡ç«¯æ‰¹å‡†æ³¨å†Œã€‚
</code></pre><hr><h3 id="_3-windows-å®¢æˆ·ç«¯æ¥å…¥" tabindex="-1"><a class="header-anchor" href="#_3-windows-å®¢æˆ·ç«¯æ¥å…¥"><span><strong>3. Windows å®¢æˆ·ç«¯æ¥å…¥</strong></span></a></h3><h4 id="æ­¥éª¤-2" tabindex="-1"><a class="header-anchor" href="#æ­¥éª¤-2"><span><strong>æ­¥éª¤</strong>ï¼š</span></a></h4><ol><li><strong>å®‰è£… Tailscale</strong><ul><li>ä¸‹è½½ Windows ç‰ˆå®‰è£…åŒ…å¹¶è¿è¡Œã€‚</li></ul></li><li><strong>é€šè¿‡å‘½ä»¤è¡Œè¿æ¥</strong></li></ol><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-powershell"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">tailscale.exe</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> up </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">login</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">server</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">http:</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">//</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;HEADSCALE_IP&gt;:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>- éœ€åœ¨æœåŠ¡ç«¯æ‰§è¡Œæ³¨å†Œå‘½ä»¤ã€‚
</code></pre><hr><h3 id="_4-å…¶ä»–å¹³å°æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#_4-å…¶ä»–å¹³å°æ³¨æ„äº‹é¡¹"><span><strong>4. å…¶ä»–å¹³å°æ³¨æ„äº‹é¡¹</strong></span></a></h3><ul><li><strong>Android/iOS</strong>ï¼š <ul><li>å®˜æ–¹å®¢æˆ·ç«¯ä¸æ”¯æŒè‡ªå®šä¹‰æœåŠ¡å™¨ï¼Œéœ€è‡ªè¡Œç¼–è¯‘ä¿®æ”¹ã€‚</li></ul></li><li><strong>OpenBSD/FreeBSD</strong>ï¼š <ul><li>ä¸ Linux æ­¥éª¤ç±»ä¼¼ï¼Œéœ€ç¡®ä¿å†…æ ¸æ”¯æŒ TUN è®¾å¤‡ã€‚</li></ul></li></ul><hr><h3 id="é€šç”¨é…ç½®å»ºè®®" tabindex="-1"><a class="header-anchor" href="#é€šç”¨é…ç½®å»ºè®®"><span><strong>é€šç”¨é…ç½®å»ºè®®</strong></span></a></h3><ol><li><strong>HTTPS å¿…éœ€æ€§</strong>ï¼š <ul><li>ç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡ Nginx/Caddy åå‘ä»£ç† Headscale çš„ <code>server_url</code> ä¸º HTTPSï¼Œå¦åˆ™éƒ¨åˆ†åŠŸèƒ½ï¼ˆå¦‚ MagicDNSï¼‰å¯èƒ½å¤±æ•ˆã€‚</li></ul></li><li><strong>é¢„æˆæƒå¯†é’¥</strong>ï¼š <ul><li>ç”Ÿæˆä¸€æ¬¡æ€§æˆ–å¯å¤ç”¨çš„å¯†é’¥ç®€åŒ–æ‰¹é‡éƒ¨ç½²ï¼š</li></ul></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> preauthkeys</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">USE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">R&gt; </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">--expiry</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 24h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li><strong>é˜²ç«å¢™è§„åˆ™</strong>ï¼š <ul><li>ç¡®ä¿å®¢æˆ·ç«¯å¯è®¿é—® Headscale çš„ç›‘å¬ç«¯å£ï¼ˆé»˜è®¤ 8080ï¼‰å’Œ DERP ä¸­ç»§ç«¯å£ï¼ˆå¦‚ UDP 3478ï¼‰ã€‚</li></ul></li></ol><hr><h3 id="æ•…éšœæ’æŸ¥" tabindex="-1"><a class="header-anchor" href="#æ•…éšœæ’æŸ¥"><span><strong>æ•…éšœæ’æŸ¥</strong></span></a></h3><ul><li><strong>æ³¨å†Œå¤±è´¥</strong>ï¼šæ£€æŸ¥ <code>server_url</code> æ˜¯å¦å¯è¾¾ï¼Œä¸”æœåŠ¡ç«¯æ—¥å¿—æ— æŠ¥é”™ã€‚</li><li><strong>NAT ç©¿é€å¤±è´¥</strong>ï¼šé€šè¿‡ <code>tailscale netcheck</code> ç¡®è®¤æ˜¯å¦ä½¿ç”¨äº†å¤‡ç”¨ DERP ä¸­ç»§ã€‚</li></ul><blockquote><p>æ›´å¤šå®¢æˆ·ç«¯ç®¡ç†å‘½ä»¤ï¼ˆå¦‚æŸ¥çœ‹èŠ‚ç‚¹ã€åˆ é™¤è®¾å¤‡ï¼‰å¯å‚è€ƒ <code>headscale nodes list</code> å’Œ <code>headscale nodes delete</code>ã€‚</p></blockquote><p>åœ¨ Tailscale ä¸­ï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹å¶å°”å¤„äºé <code>active</code> çŠ¶æ€ï¼ˆå¦‚ <code>offline</code> æˆ– <code>idle</code>ï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ‰‹åŠ¨æ¿€æ´»æˆ–ä¸»åŠ¨æ¢æ´»ï¼š</p><hr><h3 id="_1-å¼ºåˆ¶èŠ‚ç‚¹é‡æ–°è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_1-å¼ºåˆ¶èŠ‚ç‚¹é‡æ–°è¿æ¥"><span><strong>1. å¼ºåˆ¶èŠ‚ç‚¹é‡æ–°è¿æ¥</strong></span></a></h3><h4 id="æ–¹æ³•-1-ä½¿ç”¨-tailscale-up-é‡æ–°æ¿€æ´»" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-1-ä½¿ç”¨-tailscale-up-é‡æ–°æ¿€æ´»"><span><strong>æ–¹æ³• 1ï¼šä½¿ç”¨ <strong><strong><code>tailscale up</code></strong></strong> é‡æ–°æ¿€æ´»</strong></span></a></h4><p>åœ¨éæ´»è·ƒèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --reset</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>--reset</code> ä¼šå¼ºåˆ¶èŠ‚ç‚¹é‡æ–°è¿æ¥ Tailscale ç½‘ç»œï¼Œå¹¶å°è¯•é‡æ–°å»ºç«‹ç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼‰æˆ– DERP ä¸­ç»§è¿æ¥ã€‚</li></ul><h4 id="æ–¹æ³•-2-é‡å¯-tailscaled-æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•-2-é‡å¯-tailscaled-æœåŠ¡"><span><strong>æ–¹æ³• 2ï¼šé‡å¯ <strong><strong><code>tailscaled</code></strong></strong> æœåŠ¡</strong></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscaled</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # Linux</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–ï¼ˆWindowsï¼‰ï¼š</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-powershell"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Restart-Service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> Tailscale</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>é€‚ç”¨äºé•¿æ—¶é—´æœªé€šä¿¡å¯¼è‡´çš„çŠ¶æ€å¼‚å¸¸ã€‚</li></ul><hr><h3 id="_2-æ‰‹åŠ¨è§¦å‘-nat-ç©¿é€æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#_2-æ‰‹åŠ¨è§¦å‘-nat-ç©¿é€æ£€æŸ¥"><span><strong>2. æ‰‹åŠ¨è§¦å‘ NAT ç©¿é€æ£€æŸ¥</strong></span></a></h3><p>æ‰§è¡Œ <code>tailscale netcheck</code> æ£€æŸ¥å½“å‰ç½‘ç»œç¯å¢ƒï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> netcheck</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>è¾“å‡ºä¼šæ˜¾ç¤º NAT ç©¿é€çŠ¶æ€ï¼ˆå¦‚ <code>UDP blocked</code> æˆ– <code>DERP relay</code>ï¼‰ï¼Œå¸®åŠ©åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒæ•´é˜²ç«å¢™æˆ–è·¯ç”±å™¨è®¾ç½®ã€‚</li></ul><hr><h3 id="_3-ä½¿ç”¨-ping-æˆ–-curl-ä¸»åŠ¨æ¢æ´»" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨-ping-æˆ–-curl-ä¸»åŠ¨æ¢æ´»"><span><strong>3. ä½¿ç”¨ <strong><strong><code>ping</code></strong></strong> æˆ– <strong><strong><code>curl</code></strong></strong> ä¸»åŠ¨æ¢æ´»</strong></span></a></h3><p>åœ¨èŠ‚ç‚¹ A ä¸Šä¸»åŠ¨è®¿é—®èŠ‚ç‚¹ B çš„ Tailscale IPï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ping</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100.64.0.4</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æ›¿æ¢ä¸ºç›®æ ‡èŠ‚ç‚¹çš„ Tailscale IP</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–æµ‹è¯•ç«¯å£è¿é€šæ€§ï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://100.64.0.4:8080</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # æµ‹è¯• HTTP æœåŠ¡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>ä¸»åŠ¨æµé‡ä¼šè§¦å‘ Tailscale è‡ªåŠ¨å°è¯•å»ºç«‹è¿æ¥ã€‚</li></ul><hr><h3 id="_4-æ£€æŸ¥å¹¶ä¿®å¤-derp-ä¸­ç»§è¿æ¥" tabindex="-1"><a class="header-anchor" href="#_4-æ£€æŸ¥å¹¶ä¿®å¤-derp-ä¸­ç»§è¿æ¥"><span><strong>4. æ£€æŸ¥å¹¶ä¿®å¤ DERP ä¸­ç»§è¿æ¥</strong></span></a></h3><p>å¦‚æœèŠ‚ç‚¹ä¾èµ– DERP ä¸­ç»§ï¼ˆå¦‚ <code>relay &quot;selfhosted&quot;</code>ï¼‰ï¼Œéœ€ç¡®ä¿è‡ªå»º DERP æœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼š</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># åœ¨ DERP æœåŠ¡å™¨ä¸Šæ£€æŸ¥æœåŠ¡çŠ¶æ€</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> headscale</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœ DERP ä¸å¯ç”¨ï¼ŒèŠ‚ç‚¹å¯èƒ½æ— æ³•è‡ªåŠ¨æ¢å¤ï¼Œéœ€ä¿®å¤ DERP æœåŠ¡æˆ–æ”¹ç”¨å®˜æ–¹ä¸­ç»§ã€‚</li></ul><hr><h3 id="_5-è°ƒæ•´-keepalive-è®¾ç½®-é«˜çº§" tabindex="-1"><a class="header-anchor" href="#_5-è°ƒæ•´-keepalive-è®¾ç½®-é«˜çº§"><span><strong>5. è°ƒæ•´ Keepalive è®¾ç½®ï¼ˆé«˜çº§ï¼‰</strong></span></a></h3><p>åœ¨ <code>/etc/default/tailscaled</code>ï¼ˆLinuxï¼‰æˆ–æ³¨å†Œè¡¨ï¼ˆWindowsï¼‰ä¸­å¢åŠ  Keepalive é—´éš”ï¼š</p><div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-ini"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#C678DD;">TS_DEBUG_KEEPALIVE</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#98C379;">30s  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># é»˜è®¤ 60sï¼Œç¼©çŸ­å¯æé«˜æ´»æ€§æ£€æµ‹é¢‘ç‡</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>éœ€é‡å¯ <code>tailscaled</code> ç”Ÿæ•ˆã€‚</li></ul><hr><h3 id="_6-æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_6-æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜"><span><strong>6. æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜</strong></span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">journalctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -u</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tailscaled</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  # Linux å®æ—¶æ—¥å¿—</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æˆ–ï¼ˆWindowsï¼‰ï¼š</p><div class="language-powershell line-numbers-mode" data-highlighter="shiki" data-ext="powershell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-powershell"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">Get-EventLog</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">LogName Application </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Source Tailscale</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">Newest </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">10</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>å…³æ³¨ <code>magicsock</code> æˆ– <code>derp</code> ç›¸å…³é”™è¯¯ï¼Œå¦‚ <code>DERP reconnect failed</code>ã€‚</li></ul><hr><h3 id="æ€»ç»“å»ºè®®" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“å»ºè®®"><span><strong>æ€»ç»“å»ºè®®</strong></span></a></h3><ol><li><strong>ä¸´æ—¶æ¢å¤</strong>ï¼šä¼˜å…ˆä½¿ç”¨ <code>tailscale up --reset</code> æˆ–é‡å¯æœåŠ¡ã€‚</li><li><strong>é•¿æœŸç¨³å®š</strong>ï¼šæ£€æŸ¥é˜²ç«å¢™/NAT è§„åˆ™ï¼Œç¡®ä¿ UDP 41641 å’Œ DERP ç«¯å£ï¼ˆå¦‚ 3478ï¼‰å¼€æ”¾ã€‚</li><li><strong>ç›‘æ§å·¥å…·</strong>ï¼šç»“åˆ <code>tailscale status --json</code> è¾“å‡ºè‡ªåŠ¨åŒ–ç›‘æ§èŠ‚ç‚¹çŠ¶æ€ã€‚</li></ol><blockquote><p>è‹¥é—®é¢˜æŒç»­ï¼Œæäº¤è¯Šæ–­æŠ¥å‘Šï¼š<code>tailscale bugreport</code>ï¼Œå¹¶é™„ä¸Šæ—¥å¿—ã€‚</p></blockquote><hr><h3 id="ğŸ¢-å››ã€ä¼ä¸šçº§æ‰©å±•åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ğŸ¢-å››ã€ä¼ä¸šçº§æ‰©å±•åœºæ™¯"><span>ğŸ¢ å››ã€ä¼ä¸šçº§æ‰©å±•åœºæ™¯</span></a></h3><ol><li><p><strong>æ··åˆäº‘ç»„ç½‘</strong></p><p>æ‰“é€š AWS/Azure äº‘ä¸»æœºä¸æœ¬åœ°æ•°æ®ä¸­å¿ƒï¼Œæ›¿ä»£ä¸“çº¿ VPNï¼Œé€šè¿‡ ACL é™åˆ¶äº‘æ•°æ®åº“ä»…å†…ç½‘è®¿é—®ã€‚</p></li><li><p><strong>é›¶ä¿¡ä»»å®‰å…¨ä½“ç³»</strong></p><ul><li>è®¾å¤‡åŒå‘è®¤è¯ï¼ˆWireGuard å¯†é’¥ + ç”¨æˆ·èº«ä»½ï¼‰ï¼›</li><li>å¾®éš”ç¦»ç­–ç•¥ï¼ˆå¦‚ç ”å‘ç»„ä»…èƒ½è®¿é—®æµ‹è¯•ç¯å¢ƒ IP æ®µï¼‰ã€‚</li></ul></li><li><p><strong>IoT è®¾å¤‡äº’è”</strong></p><p>åµŒå…¥å¼è®¾å¤‡ï¼ˆOpenWRT è·¯ç”±å™¨ï¼‰æ¥å…¥ï¼Œå®ç°è¿œç¨‹ç®¡ç†ä¸å®‰å…¨æ›´æ–°ã€‚</p></li></ol><hr><h3 id="âš–ï¸-äº”ã€å¯¹æ¯”é€‰å‹å»ºè®®" tabindex="-1"><a class="header-anchor" href="#âš–ï¸-äº”ã€å¯¹æ¯”é€‰å‹å»ºè®®"><span>âš–ï¸ äº”ã€å¯¹æ¯”é€‰å‹å»ºè®®</span></a></h3><table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>è‡ªæ‰˜ç®¡å¤æ‚åº¦</strong></th><th><strong>åè®®æ€§èƒ½</strong></th><th><strong>ä¼ä¸šçº§ç‰¹æ€§</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>Headscale</strong></td><td>ä¸­ â˜…â˜…â˜†</td><td>WireGuardï¼ˆç”¨æˆ·æ€ï¼‰</td><td>å¤šç§Ÿæˆ·éš”ç¦»ã€ACL å¼ºæ§</td><td>ä¸­å¤§å‹ä¼ä¸šã€åˆè§„ä¸¥æ ¼åœºæ™¯</td></tr><tr><td><strong>NetBird</strong></td><td>é«˜ â˜…â˜…â˜…</td><td>WireGuardï¼ˆå†…æ ¸æ€ï¼‰</td><td>å®˜æ–¹æ”¯æŒå®Œå–„</td><td>éœ€å¼€ç®±å³ç”¨ã€è½»é‡çº§ç§æœ‰éƒ¨ç½²</td></tr><tr><td><strong>ZeroTier</strong></td><td>ä½ â˜…â˜†â˜†</td><td>è‡ªæœ‰åè®®</td><td>å…è´¹ç‰ˆåŠŸèƒ½å—é™</td><td>ä¸ªäººæˆ–å°å‹å›¢é˜Ÿå¿«é€Ÿç»„ç½‘</td></tr></tbody></table><blockquote><p>âœ… <strong>Headscale æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p></blockquote><ul><li><strong>å®Œå…¨è‡ªä¸»å¯æ§</strong>ï¼šä»æ•°æ®å­˜å‚¨åˆ°æµé‡ä¸­è½¬å…¨ç¨‹ç§æœ‰åŒ–ï¼›</li><li><strong>æˆæœ¬ä¼˜åŒ–</strong>ï¼šæ— éœ€æŒ‰è®¾å¤‡ä»˜è´¹ï¼Œä¸­ç»§æœåŠ¡å™¨å¯å¤ç”¨ç°æœ‰èµ„æºï¼›</li><li><strong>ç”Ÿæ€å…¼å®¹</strong>ï¼šå¤ç”¨ Tailscale å®¢æˆ·ç«¯ï¼Œé™ä½è¿ç§»æˆæœ¬ã€‚</li></ul><hr><h3 id="âš ï¸-å…­ã€æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#âš ï¸-å…­ã€æ³¨æ„äº‹é¡¹"><span>âš ï¸ å…­ã€æ³¨æ„äº‹é¡¹</span></a></h3><ol><li><strong>åŸŸåä¸è¯ä¹¦</strong>ï¼šå¿…é¡»é…ç½®æœ‰æ•ˆåŸŸå + HTTPSï¼ˆå¦åˆ™å®¢æˆ·ç«¯æ³¨å†Œå¤±è´¥ï¼‰ï¼Œå¯é€šè¿‡ Nginx/Caddy åå‘ä»£ç†è§£å†³ã€‚</li><li><strong>NAT ç©¿é€ä¼˜åŒ–</strong>ï¼šè‹¥ç›´è¿å¤±è´¥ï¼Œéœ€æ£€æŸ¥é˜²ç«å¢™æ”¾è¡Œ UDP 3478 åŠ 49152-65535 ç«¯å£ï¼Œæˆ–å¼ºåŒ– DERP ä¸­ç»§ã€‚</li><li><strong>é«˜å¯ç”¨è®¾è®¡</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®® PostgreSQL æ›¿ä»£ SQLiteï¼Œå¹¶éƒ¨ç½²å¤šå‰¯æœ¬ Headscale æœåŠ¡ã€‚</li></ol><hr><p><strong>æ€»ç»“</strong>ï¼šHeadscale æ˜¯å½“å‰ç§æœ‰åŒ–ç»„ç½‘æ–¹æ¡ˆä¸­<strong>å¹³è¡¡åŠŸèƒ½ã€æ§åˆ¶æƒä¸åè®®æ€§èƒ½çš„ä¼˜é€‰</strong>ï¼Œå°¤å…¶é€‚åˆéœ€å®šåˆ¶å®‰å…¨ç­–ç•¥ã€è§„é¿äº‘æœåŠ¡ä¾èµ–çš„ä¼ä¸šåœºæ™¯ã€‚ç»“åˆå¯è§†åŒ–å·¥å…· <a href="https://github.com/next-admin/headscale-admin" target="_blank" rel="noopener noreferrer">https://github.com/next-admin/headscale-admin</a> å¯è¿›ä¸€æ­¥æå‡ç®¡ç†æ•ˆç‡ã€‚éƒ¨ç½²è¯¦è§ <a href="https://headscale.net/" target="_blank" rel="noopener noreferrer">https://headscale.net/</a> åŠ <a href="https://github.com/juanfont/headscale%E3%80%82" target="_blank" rel="noopener noreferrer">https://github.com/juanfont/headscaleã€‚</a></p><h2 id="å…«ã€é«˜çº§é€‰é¡¹-advertise-routes-å’Œ-advertise-exit-node" tabindex="-1"><a class="header-anchor" href="#å…«ã€é«˜çº§é€‰é¡¹-advertise-routes-å’Œ-advertise-exit-node"><span>å…«ã€é«˜çº§é€‰é¡¹--advertise-routes å’Œ -advertise-exit-node</span></a></h2><p>åœ¨ Tailscale/Headscale ä¸­ï¼Œ<code>--advertise-routes</code> å’Œ <code>--advertise-exit-node</code> æ˜¯ä¸¤ä¸ªå…³é”®çš„é«˜çº§é€‰é¡¹ï¼Œç”¨äºæ‰©å±•è™šæ‹Ÿå±€åŸŸç½‘çš„ç½‘ç»œåŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å®ƒä»¬çš„æ ¸å¿ƒä½œç”¨å’Œä½¿ç”¨åœºæ™¯ï¼š</p><hr><h3 id="_1-advertise-routes-å­ç½‘è·¯ç”±é€šå‘Š" tabindex="-1"><a class="header-anchor" href="#_1-advertise-routes-å­ç½‘è·¯ç”±é€šå‘Š"><span>1. <strong><code>--advertise-routes</code>****ï¼šå­ç½‘è·¯ç”±é€šå‘Š</strong></span></a></h3><h4 id="åŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½"><span><strong>åŠŸèƒ½</strong></span></a></h4><p>å…è®¸èŠ‚ç‚¹å°†å…¶æ‰€åœ¨çš„<strong>ç‰©ç†å±€åŸŸç½‘ç½‘æ®µ</strong>ï¼ˆå¦‚å®¶åº­/å…¬å¸å†…ç½‘ï¼‰å…±äº«ç»™ Tailscale ç½‘ç»œä¸­çš„å…¶ä»–è®¾å¤‡ï¼Œä½¿è¿™äº›è®¾å¤‡èƒ½é€šè¿‡è™šæ‹Ÿç½‘ç»œè®¿é—®å®é™…ç‰©ç†ç½‘ç»œã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯"><span><strong>ä½¿ç”¨åœºæ™¯</strong></span></a></h4><ul><li><p><strong>è®¿é—®å®¶åº­NAS</strong>ï¼š</p><p>å®¶åº­è·¯ç”±å™¨è¿è¡Œ Tailscale å¹¶é€šå‘Š <code>192.168.1.0/24</code>ï¼Œå¤–å‡ºçš„æ‰‹æœº/ç¬”è®°æœ¬é€šè¿‡ Tailscale ç›´æ¥è®¿é—®å®¶åº­å†…ç½‘è®¾å¤‡ï¼Œæ— éœ€é¢å¤– VPN é…ç½®ã€‚</p></li><li><p><strong>ä¼ä¸šå¤šç«™ç‚¹äº’è”</strong>ï¼š</p><p>åˆ†æ”¯æœºæ„çš„è·¯ç”±å™¨åˆ†åˆ«é€šå‘Š <code>10.1.0.0/24</code> å’Œ <code>10.2.0.0/24</code>ï¼Œå®ç°è·¨åœ°åŸŸå±€åŸŸç½‘äº’é€šã€‚</p></li><li><p><strong>æ··åˆäº‘ç»„ç½‘</strong>ï¼š</p><p>VPS é€šå‘Šäº‘æœåŠ¡å™¨ç§æœ‰ç½‘æ®µï¼ˆå¦‚ <code>172.16.0.0/16</code>ï¼‰ï¼Œæœ¬åœ°è®¾å¤‡ç›´æ¥è®¿é—®äº‘å†…èµ„æºã€‚</p></li></ul><h4 id="é…ç½®ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç¤ºä¾‹"><span><strong>é…ç½®ç¤ºä¾‹</strong></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å®¶åº­è·¯ç”±å™¨é€šå‘Šæœ¬åœ°ç½‘æ®µ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --advertise-routes=192.168.1.0/24</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=https://headscale.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Headscale å¯ç”¨è·¯ç”±ï¼ˆéœ€ç®¡ç†å‘˜æ“ä½œï¼‰</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">headscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> routes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">å‘½åç©º</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">é—´&gt; &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">èŠ‚ç‚¹</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">å&gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">192.168.1.0/24</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ³¨æ„äº‹é¡¹-1" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-1"><span><strong>æ³¨æ„äº‹é¡¹</strong></span></a></h4><ul><li>éœ€åœ¨ Headscale æ§åˆ¶ç«¯æ‰‹åŠ¨å®¡æ‰¹è·¯ç”±ï¼ˆé»˜è®¤å…³é—­ï¼‰ã€‚</li><li>é€šå‘Šçš„ç½‘æ®µä¸èƒ½ä¸ Tailscale è™šæ‹Ÿ IP æ®µï¼ˆå¦‚ <code>100.64.0.0/10</code>ï¼‰å†²çªã€‚</li></ul><hr><h3 id="_2-advertise-exit-node-å‡ºå£èŠ‚ç‚¹é€šå‘Š" tabindex="-1"><a class="header-anchor" href="#_2-advertise-exit-node-å‡ºå£èŠ‚ç‚¹é€šå‘Š"><span>2. <strong><code>--advertise-exit-node</code>****ï¼šå‡ºå£èŠ‚ç‚¹é€šå‘Š</strong></span></a></h3><h4 id="åŠŸèƒ½-1" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½-1"><span><strong>åŠŸèƒ½</strong></span></a></h4><p>å°†å½“å‰èŠ‚ç‚¹è®¾ä¸º<strong>æµé‡å‡ºå£</strong>ï¼Œå…è®¸å…¶ä»– Tailscale è®¾å¤‡é€šè¿‡è¯¥èŠ‚ç‚¹è®¿é—®äº’è”ç½‘ï¼Œç±»ä¼¼ VPN çš„å…¨å±€ä»£ç†æ¨¡å¼ã€‚</p><h4 id="ä½¿ç”¨åœºæ™¯-1" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åœºæ™¯-1"><span><strong>ä½¿ç”¨åœºæ™¯</strong></span></a></h4><ul><li><p><strong>å®‰å…¨è¿œç¨‹åŠå…¬</strong>ï¼š</p><p>å…¬å¸å†…ç½‘è®¾å¤‡ä½œä¸ºå‡ºå£èŠ‚ç‚¹ï¼Œå‘˜å·¥åœ¨å¤–é€šè¿‡è¯¥èŠ‚ç‚¹è®¿é—®äº’è”ç½‘ï¼Œæµé‡åŠ å¯†ä¸”éšè—çœŸå® IPã€‚</p></li><li><p><strong>ç»•è¿‡åœ°åŸŸé™åˆ¶</strong>ï¼š</p><p>æµ·å¤– VPS ä½œä¸ºå‡ºå£èŠ‚ç‚¹ï¼Œå®ç°ç§‘å­¦ä¸Šç½‘ï¼ˆéœ€éµå®ˆå½“åœ°æ³•å¾‹ï¼‰ã€‚</p></li><li><p><strong>ç§»åŠ¨è®¾å¤‡å…±äº«èœ‚çªIP</strong>ï¼š</p><p>æ‰‹æœºå¼€å¯å‡ºå£èŠ‚ç‚¹æ¨¡å¼ï¼Œæµ‹è¯•æœºé€šè¿‡æ‰‹æœºæµé‡åŠ¨æ€åˆ‡æ¢ IPï¼ˆå¦‚æµ‹è¯•çŸ­ä¿¡æ¥å£é˜²åˆ·ï¼‰ã€‚</p></li></ul><h4 id="é…ç½®ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç¤ºä¾‹-1"><span><strong>é…ç½®ç¤ºä¾‹</strong></span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å°†å½“å‰èŠ‚ç‚¹è®¾ä¸ºå‡ºå£èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --advertise-exit-node</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=https://headscale.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å…¶ä»–è®¾å¤‡ä½¿ç”¨è¯¥å‡ºå£èŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">å‡ºå£èŠ‚ç‚¹IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node-allow-lan-access</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ³¨æ„äº‹é¡¹-2" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„äº‹é¡¹-2"><span><strong>æ³¨æ„äº‹é¡¹</strong></span></a></h4><ul><li>å‡ºå£èŠ‚ç‚¹éœ€å¼€å¯ IP è½¬å‘ï¼ˆLinux æ‰§è¡Œ <code>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code>ï¼‰ã€‚</li><li>å¯èƒ½æ˜¾è‘—å¢åŠ å‡ºå£èŠ‚ç‚¹çš„æµé‡è´Ÿè½½å’Œç”µæ± æ¶ˆè€—ï¼ˆç§»åŠ¨è®¾å¤‡ï¼‰ã€‚</li></ul><hr><h3 id="_3-ç»„åˆä½¿ç”¨æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-ç»„åˆä½¿ç”¨æ¡ˆä¾‹"><span>3. <strong>ç»„åˆä½¿ç”¨æ¡ˆä¾‹</strong></span></a></h3><h4 id="å®¶åº­ç½‘ç»œæ¢çº½" tabindex="-1"><a class="header-anchor" href="#å®¶åº­ç½‘ç»œæ¢çº½"><span><strong>å®¶åº­ç½‘ç»œæ¢çº½</strong></span></a></h4><ul><li><strong>è·¯ç”±å™¨é…ç½®</strong>ï¼š</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --advertise-routes=192.168.1.0/24</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --advertise-exit-node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>- å…¶ä»–è®¾å¤‡å¯è®¿é—®å®¶åº­å†…ç½‘ï¼ˆå¦‚ NASï¼‰ï¼ŒåŒæ—¶é€šè¿‡å®¶åº­å®½å¸¦å‡ºå£ä¸Šç½‘ã€‚  
</code></pre><ul><li><p><strong>æ‰‹æœºä¸´æ—¶åˆ‡æ¢IP</strong>ï¼š</p><p>åŠ¨æ€å¯ç”¨æ‰‹æœºä½œä¸ºå‡ºå£èŠ‚ç‚¹ï¼Œæµ‹è¯•æœºé€šè¿‡ <code>--exit-node</code> å¿«é€Ÿæ›´æ¢å…¬ç½‘ IPã€‚</p></li></ul><hr><h3 id="_4-å¸¸è§é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_4-å¸¸è§é—®é¢˜"><span>4. <strong>å¸¸è§é—®é¢˜</strong></span></a></h3><ul><li><p><strong>è·¯ç”±æœªç”Ÿæ•ˆ</strong>ï¼š</p><p>æ£€æŸ¥ Headscale æ§åˆ¶ç«¯æ˜¯å¦å¯ç”¨è·¯ç”±ï¼ˆ<code>headscale routes list</code>ï¼‰ã€‚</p></li><li><p><strong>æµé‡æ³„éœ²</strong>ï¼š</p><p>è‹¥å‡ºå£èŠ‚ç‚¹æœªæ­£ç¡®é…ç½®é˜²ç«å¢™ï¼Œå¯èƒ½å¯¼è‡´æœ¬åœ°ç½‘ç»œæš´éœ²ï¼ˆå»ºè®®æ­é… <code>--exit-node-allow-lan-access=false</code>ï¼‰ã€‚</p></li></ul><p>é€šè¿‡è¿™ä¸¤ä¸ªé€‰é¡¹ï¼ŒTailscale/Headscale èƒ½å®ç°ä»ç®€å•çš„è®¾å¤‡äº’è”åˆ°å¤æ‚çš„æ··åˆç½‘ç»œæ¶æ„ï¼Œæ»¡è¶³çµæ´»ç»„ç½‘éœ€æ±‚ã€‚</p><h2 id="ä¹ã€-exit-node-å¦‚æœå¼€å¯åˆ‡æ¢å‡ºå£å-æ˜¯ä¸æ˜¯é»˜è®¤æ‰€æœ‰è¯·æ±‚-éƒ½èµ°-æ–°çš„å‡ºå£äº†" tabindex="-1"><a class="header-anchor" href="#ä¹ã€-exit-node-å¦‚æœå¼€å¯åˆ‡æ¢å‡ºå£å-æ˜¯ä¸æ˜¯é»˜è®¤æ‰€æœ‰è¯·æ±‚-éƒ½èµ°-æ–°çš„å‡ºå£äº†"><span>ä¹ã€--exit-node å¦‚æœå¼€å¯åˆ‡æ¢å‡ºå£åï¼Œ æ˜¯ä¸æ˜¯é»˜è®¤æ‰€æœ‰è¯·æ±‚ï¼Œéƒ½èµ° æ–°çš„å‡ºå£äº†ï¼Ÿ</span></a></h2><p>åœ¨ Tailscale/Headscale ç½‘ç»œä¸­ï¼Œå½“æ‚¨é€šè¿‡ <code>--exit-node</code> å‚æ•°æŒ‡å®šæŸä¸ªèŠ‚ç‚¹ä¸ºå‡ºå£èŠ‚ç‚¹åï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰äº’è”ç½‘æµé‡éƒ½ä¼šé€šè¿‡è¯¥å‡ºå£èŠ‚ç‚¹è½¬å‘</strong>ï¼Œä½†æœ¬åœ°å±€åŸŸç½‘ï¼ˆLANï¼‰æµé‡æ˜¯å¦ç»è¿‡å‡ºå£èŠ‚ç‚¹å–å†³äºé¢å¤–é…ç½®ã€‚ä»¥ä¸‹æ˜¯å…·ä½“è§„åˆ™å’Œæ³¨æ„äº‹é¡¹ï¼š</p><hr><h3 id="_1-é»˜è®¤è¡Œä¸º-å…¨å±€æµé‡é‡å®šå‘" tabindex="-1"><a class="header-anchor" href="#_1-é»˜è®¤è¡Œä¸º-å…¨å±€æµé‡é‡å®šå‘"><span>1. <strong>é»˜è®¤è¡Œä¸ºï¼šå…¨å±€æµé‡é‡å®šå‘</strong></span></a></h3><ul><li><p><strong>æ‰€æœ‰äº’è”ç½‘æµé‡</strong>ï¼š</p><p>å¯ç”¨å‡ºå£èŠ‚ç‚¹åï¼Œè®¾å¤‡çš„æ‰€æœ‰å¯¹å¤–äº’è”ç½‘è¯·æ±‚ï¼ˆå¦‚è®¿é—®ç™¾åº¦ã€GitHubï¼‰é»˜è®¤ä¼šé€šè¿‡å‡ºå£èŠ‚ç‚¹çš„å…¬ç½‘ IP æµå‡ºï¼Œæ‚¨çš„æœ¬åœ° IP ä¼šè¢«éšè—ã€‚</p></li><li><p><strong>é…ç½®å‘½ä»¤ç¤ºä¾‹</strong>ï¼š</p></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">å‡ºå£èŠ‚ç‚¹IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="_2-å±€åŸŸç½‘æµé‡çš„ç‰¹æ®Šå¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-å±€åŸŸç½‘æµé‡çš„ç‰¹æ®Šå¤„ç†"><span>2. <strong>å±€åŸŸç½‘æµé‡çš„ç‰¹æ®Šå¤„ç†</strong></span></a></h3><ul><li><p><strong>é»˜è®¤ä¸é‡å®šå‘å±€åŸŸç½‘æµé‡</strong>ï¼š</p><p>Tailscale é»˜è®¤ä¸ä¼šå°†æœ¬åœ°å±€åŸŸç½‘ï¼ˆå¦‚ <code>192.168.1.0/24</code>ï¼‰çš„æµé‡è½¬å‘åˆ°å‡ºå£èŠ‚ç‚¹ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡æœ¬åœ°ç½‘ç»œé€šä¿¡ã€‚</p></li><li><p><strong>å…è®¸å±€åŸŸç½‘æµé‡é‡å®šå‘</strong>ï¼š</p><p>è‹¥éœ€å¼ºåˆ¶æ‰€æœ‰æµé‡ï¼ˆåŒ…æ‹¬å±€åŸŸç½‘ï¼‰éƒ½ç»è¿‡å‡ºå£èŠ‚ç‚¹ï¼Œéœ€æ˜¾å¼æ·»åŠ  <code>--exit-node-allow-lan-access=true</code> å‚æ•°ï¼š</p></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">å‡ºå£èŠ‚ç‚¹IP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node-allow-lan-access=true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="_3-ä¾‹å¤–æƒ…å†µ" tabindex="-1"><a class="header-anchor" href="#_3-ä¾‹å¤–æƒ…å†µ"><span>3. <strong>ä¾‹å¤–æƒ…å†µ</strong></span></a></h3><ul><li><p><strong>Tailscale è™šæ‹Ÿç½‘ç»œæµé‡</strong>ï¼š</p><p>ä¸å…¶ä»– Tailscale èŠ‚ç‚¹çš„é€šä¿¡ï¼ˆå¦‚ <code>100.x.y.z</code>ï¼‰å§‹ç»ˆä¸ºç‚¹å¯¹ç‚¹ç›´è¿ï¼ˆæˆ–é€šè¿‡ DERP ä¸­ç»§ï¼‰ï¼Œä¸å—å‡ºå£èŠ‚ç‚¹å½±å“ã€‚</p></li><li><p><strong>æŒ‰éœ€æ’é™¤ç‰¹å®šæµé‡</strong>ï¼š</p><p>å¯é€šè¿‡è·¯ç”±ç­–ç•¥æˆ– ACL è§„åˆ™é™åˆ¶æŸäº›ç›®æ ‡ IP ä¸ç»è¿‡å‡ºå£èŠ‚ç‚¹ï¼ˆéœ€æ‰‹åŠ¨é…ç½®ï¼‰ã€‚</p></li></ul><hr><h3 id="_4-éªŒè¯æµé‡è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#_4-éªŒè¯æµé‡è·¯å¾„"><span>4. <strong>éªŒè¯æµé‡è·¯å¾„</strong></span></a></h3><ul><li><p><strong>æ£€æŸ¥å½“å‰è·¯ç”±</strong>ï¼š</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ç¡®è®¤æµé‡èµ°å‘ï¼š</p></li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>è¾“å‡ºä¸­ä¼šæ˜¾ç¤º \`Exit node: &lt;IP&gt;\` å’Œæµé‡ç»Ÿè®¡ã€‚
</code></pre><ul><li><p><strong>æµ‹è¯•å…¬ç½‘ IP</strong>ï¼š</p><p>è®¿é—® <a href="https://ipv4.icanhazip.com" target="_blank" rel="noopener noreferrer">https://ipv4.icanhazip.com</a> ç¡®è®¤æ˜¾ç¤ºçš„ IP æ˜¯å¦ä¸ºå‡ºå£èŠ‚ç‚¹çš„å…¬ç½‘ IPã€‚</p></li></ul><hr><h3 id="_5-æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#_5-æ³¨æ„äº‹é¡¹"><span>5. <strong>æ³¨æ„äº‹é¡¹</strong></span></a></h3><ul><li><p><strong>æ€§èƒ½å½±å“</strong>ï¼š</p><p>å‡ºå£èŠ‚ç‚¹å¯èƒ½æˆä¸ºç“¶é¢ˆï¼Œå°¤å…¶æ˜¯é«˜å»¶è¿Ÿæˆ–ä½å¸¦å®½åœºæ™¯ï¼ˆå¦‚è·¨å›½èŠ‚ç‚¹ï¼‰ã€‚</p></li><li><p><strong>å®‰å…¨é£é™©</strong>ï¼š</p><p>è‹¥å‡ºå£èŠ‚ç‚¹è¢«å…¥ä¾µï¼Œæ‰€æœ‰æµé‡å¯èƒ½è¢«ç›‘å¬ï¼Œå»ºè®®ä»…ä¿¡ä»»è‡ªå»ºèŠ‚ç‚¹ã€‚</p></li><li><p><strong>ç§»åŠ¨è®¾å¤‡è€—ç”µ</strong>ï¼š</p><p>æ‰‹æœºä½œä¸ºå‡ºå£èŠ‚ç‚¹æ—¶ï¼Œç”µæ± æ¶ˆè€—ä¼šæ˜¾è‘—å¢åŠ ã€‚</p></li></ul><hr><h3 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h3><ul><li><strong>é»˜è®¤ç”Ÿæ•ˆèŒƒå›´</strong>ï¼šä»…äº’è”ç½‘æµé‡ï¼Œä¸åŒ…æ‹¬æœ¬åœ°å±€åŸŸç½‘ã€‚</li><li><strong>å…¨æµé‡é‡å®šå‘</strong>ï¼šéœ€é¢å¤–å¯ç”¨ <code>--exit-node-allow-lan-access</code>ã€‚</li><li><strong>Tailscale èŠ‚ç‚¹é—´æµé‡</strong>ï¼šå§‹ç»ˆç‹¬ç«‹äºå‡ºå£èŠ‚ç‚¹ã€‚</li></ul><p>å¦‚éœ€ä¸´æ—¶å…³é—­å‡ºå£èŠ‚ç‚¹ï¼Œè¿è¡Œ <code>tailscale up --exit-node=&quot;&quot;</code>ã€‚</p><h2 id="åã€å¦‚ä½•å®ç°-ç±»ä¼¼-socks5çš„æ•ˆæœ-è®¾å¤‡a-é€šè¿‡socks5-ç›´æ¥è®¿é—®è®¾å¤‡bçš„ç½‘ç»œã€‚" tabindex="-1"><a class="header-anchor" href="#åã€å¦‚ä½•å®ç°-ç±»ä¼¼-socks5çš„æ•ˆæœ-è®¾å¤‡a-é€šè¿‡socks5-ç›´æ¥è®¿é—®è®¾å¤‡bçš„ç½‘ç»œã€‚"><span>åã€å¦‚ä½•å®ç° ç±»ä¼¼ socks5çš„æ•ˆæœï¼Ÿ è®¾å¤‡Aï¼Œé€šè¿‡socks5 ç›´æ¥è®¿é—®è®¾å¤‡Bçš„ç½‘ç»œã€‚</span></a></h2><p>ä»¥ä¸‹æ˜¯å®ç°è®¾å¤‡Aé€šè¿‡SOCKS5ä»£ç†ç›´æ¥è®¿é—®è®¾å¤‡Bç½‘ç»œçš„å‡ ç§æ–¹æ³•ï¼Œç»“åˆä¸åŒæŠ€æœ¯æ–¹æ¡ˆå’Œé€‚ç”¨åœºæ™¯ï¼š</p><hr><h3 id="ä¸€ã€åŸºäºtailscaleçš„è™šæ‹Ÿå±€åŸŸç½‘æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€åŸºäºtailscaleçš„è™šæ‹Ÿå±€åŸŸç½‘æ–¹æ¡ˆ"><span>ä¸€ã€<strong>åŸºäºTailscaleçš„è™šæ‹Ÿå±€åŸŸç½‘æ–¹æ¡ˆ</strong></span></a></h3><ol><li><strong>æ ¸å¿ƒåŸç†</strong><ul><li>ä½¿ç”¨Tailscaleä¸ºè®¾å¤‡Aå’Œè®¾å¤‡Båˆ›å»ºåŠ å¯†çš„è™šæ‹Ÿå±€åŸŸç½‘ï¼ˆåŸºäºWireGuardï¼‰ï¼Œæ‰€æœ‰è®¾å¤‡åˆ†é…<code>100.x.x.x</code>å›ºå®šIPï¼Œæ— éœ€å…¬ç½‘IPæˆ–ç«¯å£è½¬å‘ã€‚</li><li>é€šè¿‡å­ç½‘è·¯ç”±ï¼ˆ<code>--advertise-routes</code>ï¼‰å°†è®¾å¤‡Bçš„æœ¬åœ°ç½‘ç»œæš´éœ²ç»™è®¾å¤‡Aï¼Œå®ç°ç±»ä¼¼SOCKS5çš„é€æ˜ä»£ç†æ•ˆæœã€‚</li></ul></li><li><strong>é…ç½®æ­¥éª¤</strong><ul><li><strong>è®¾å¤‡Bï¼ˆæœåŠ¡ç«¯ï¼‰</strong>ï¼š</li></ul></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># å¯ç”¨å­ç½‘è·¯ç”±ï¼ˆå‡è®¾è®¾å¤‡Bçš„å±€åŸŸç½‘ä¸º192.168.1.0/24ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --advertise-routes=192.168.1.0/24</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --login-server=https://headscale.example.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>- **è®¾å¤‡Aï¼ˆå®¢æˆ·ç«¯ï¼‰**ï¼š  
</code></pre><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æ¥å—å­ç½‘è·¯ç”±å¹¶è¿æ¥</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tailscale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> up</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --accept-routes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --exit-node=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">è®¾å¤‡Bçš„TailscaleIP</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>- **éªŒè¯**ï¼šè®¾å¤‡Aå¯ç›´æ¥è®¿é—®è®¾å¤‡Bæ‰€åœ¨å±€åŸŸç½‘çš„ä»»ä½•æœåŠ¡ï¼ˆå¦‚\`192.168.1.100:8080\`ï¼‰ã€‚
</code></pre><ol start="3"><li><strong>ä¼˜åŠ¿</strong><ul><li>é›¶é…ç½®NATç©¿é€ï¼Œè‡ªåŠ¨å»ºç«‹P2Pç›´è¿æˆ–é€šè¿‡DERPä¸­ç»§ã€‚</li><li>ç«¯åˆ°ç«¯åŠ å¯†ï¼Œæ— éœ€é¢å¤–ä»£ç†å·¥å…·ã€‚</li></ul></li></ol><hr><h3 id="äºŒã€ä¼ ç»Ÿsocks5ä»£ç†æ­å»ºæ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#äºŒã€ä¼ ç»Ÿsocks5ä»£ç†æ­å»ºæ–¹æ¡ˆ"><span>äºŒã€<strong>ä¼ ç»ŸSOCKS5ä»£ç†æ­å»ºæ–¹æ¡ˆ</strong></span></a></h3><ol><li><strong>åœ¨è®¾å¤‡Bä¸Šéƒ¨ç½²SOCKS5æœåŠ¡</strong><ul><li><strong>Pythonå®ç°</strong>ï¼ˆéœ€è®¾å¤‡Bå®‰è£…Pythonï¼‰ï¼š</li></ul></li></ol><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-python"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> socket, socks</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">socks.</span><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">set_default_proxy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(socks.</span><span style="--shiki-light:#383A42;--shiki-dark:#D19A66;">SOCKS5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;0.0.0.0&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1080</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ç›‘å¬1080ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">socket.socket </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> socks.socksocket</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><pre><code>- **ä¸“ä¸šå·¥å…·**ï¼šå¦‚\`Dante\`æˆ–\`3proxy\`ï¼Œæ”¯æŒé«˜æ€§èƒ½å¹¶å‘ã€‚
</code></pre><ol start="2"><li><strong>è®¾å¤‡Aé…ç½®ä»£ç†</strong><ul><li><strong>å‘½ä»¤è¡Œå·¥å…·</strong>ï¼š</li></ul></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --socks5</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">è®¾å¤‡B_I</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">P&gt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">:1080</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> http://å†…ç½‘æœåŠ¡åœ°å€</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>- **å…¨å±€ç³»ç»Ÿä»£ç†**ï¼šåœ¨è®¾å¤‡Açš„ç½‘ç»œè®¾ç½®ä¸­å¡«å†™SOCKS5ä»£ç†åœ°å€ï¼ˆè®¾å¤‡Bçš„IPå’Œç«¯å£ï¼‰ã€‚
</code></pre><ol start="3"><li><strong>æ³¨æ„äº‹é¡¹</strong><ul><li>éœ€åœ¨è®¾å¤‡Bçš„é˜²ç«å¢™æ”¾è¡ŒSOCKS5ç«¯å£ï¼ˆå¦‚1080ï¼‰ã€‚</li><li>è‹¥è®¾å¤‡Båœ¨NATåï¼Œéœ€é…ç½®è·¯ç”±å™¨ç«¯å£è½¬å‘æˆ–ä½¿ç”¨å†…ç½‘ç©¿é€å·¥å…·ï¼ˆå¦‚frpï¼‰ã€‚</li></ul></li></ol><hr><h3 id="ä¸‰ã€sshéš§é“è½¬socks5-æ— éœ€é¢å¤–å®‰è£…" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€sshéš§é“è½¬socks5-æ— éœ€é¢å¤–å®‰è£…"><span>ä¸‰ã€<strong>SSHéš§é“è½¬SOCKS5ï¼ˆæ— éœ€é¢å¤–å®‰è£…ï¼‰</strong></span></a></h3><ol><li><strong>é€šè¿‡SSHåŠ¨æ€ç«¯å£è½¬å‘</strong><ul><li>åœ¨è®¾å¤‡Aæ‰§è¡Œï¼š</li></ul></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -D</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1080</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user@</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">è®¾å¤‡B_I</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">P&gt;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># æœ¬åœ°1080ç«¯å£æ˜ å°„ä¸ºè®¾å¤‡Bçš„SOCKS5ä»£ç†</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><pre><code>- è®¾å¤‡Açš„åº”ç”¨ç¨‹åºé…ç½®SOCKS5ä»£ç†ä¸º\`127.0.0.1:1080\`ï¼Œæ‰€æœ‰æµé‡é€šè¿‡è®¾å¤‡Bè½¬å‘ã€‚
</code></pre><ol start="2"><li><strong>é€‚ç”¨åœºæ™¯</strong><ul><li>è®¾å¤‡Béœ€è¿è¡ŒSSHæœåŠ¡ï¼ˆé»˜è®¤22ç«¯å£ï¼‰ã€‚</li><li>é€‚åˆä¸´æ—¶è®¿é—®æˆ–å®‰å…¨è¦æ±‚é«˜çš„ç¯å¢ƒï¼ˆSSHè‡ªå¸¦åŠ å¯†ï¼‰ã€‚</li></ul></li></ol><hr><h3 id="å››ã€dockerå®¹å™¨åŒ–socks5æœåŠ¡" tabindex="-1"><a class="header-anchor" href="#å››ã€dockerå®¹å™¨åŒ–socks5æœåŠ¡"><span>å››ã€<strong>Dockerå®¹å™¨åŒ–SOCKS5æœåŠ¡</strong></span></a></h3><ol><li><strong>åœ¨è®¾å¤‡Bè¿è¡ŒSOCKS5å®¹å™¨</strong></li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> run</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -d</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --name=socks5</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1080:1080</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> serjs/go-socks5-proxy</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li><strong>è®¾å¤‡Aé€šè¿‡å®¹å™¨IPè®¿é—®</strong><ul><li>è‹¥è®¾å¤‡Bçš„Dockerç½‘ç»œä¸ºæ¡¥æ¥æ¨¡å¼ï¼Œéœ€æ˜ å°„å®¿ä¸»æœºç«¯å£ï¼ˆå¦‚<code>-p 1080:1080</code>ï¼‰ã€‚</li></ul></li></ol><hr><h3 id="æ–¹æ¡ˆå¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#æ–¹æ¡ˆå¯¹æ¯”"><span><strong>æ–¹æ¡ˆå¯¹æ¯”</strong></span></a></h3><table><thead><tr><th>æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>å¤æ‚åº¦</th><th>å®‰å…¨æ€§</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>Tailscaleå­ç½‘è·¯ç”±</td><td>é•¿æœŸç¨³å®šè®¿é—®ï¼Œå¤šè®¾å¤‡äº’é€š</td><td>ä½</td><td>é«˜ï¼ˆåŠ å¯†ï¼‰</td><td>é«˜ï¼ˆP2Pï¼‰</td></tr><tr><td>ä¼ ç»ŸSOCKS5ä»£ç†</td><td>éœ€å…¼å®¹è€æ—§åº”ç”¨æˆ–ç‰¹å®šåè®®</td><td>ä¸­</td><td>ä¾èµ–é…ç½®</td><td>ä¸­</td></tr><tr><td>SSHéš§é“</td><td>ä¸´æ—¶è®¿é—®ï¼Œè®¾å¤‡å·²å¼€æ”¾SSH</td><td>ä½</td><td>é«˜</td><td>ä¸­</td></tr><tr><td>Docker SOCKS5</td><td>å¿«é€Ÿéƒ¨ç½²ï¼Œç¯å¢ƒéš”ç¦»</td><td>ä¸­</td><td>ä¸­</td><td>ä¸­</td></tr></tbody></table><hr><h3 id="æ¨èé€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#æ¨èé€‰æ‹©"><span><strong>æ¨èé€‰æ‹©</strong></span></a></h3><ul><li><strong>ä¼˜å…ˆTailscale</strong>ï¼šè‹¥è®¾å¤‡Bä¸ºå®¶åº­NASæˆ–ä¼ä¸šå†…ç½‘ï¼ŒTailscaleçš„å­ç½‘è·¯ç”±æœ€ä¾¿æ·å®‰å…¨ã€‚</li><li><strong>ä¸´æ—¶éœ€æ±‚</strong>ï¼šSSHéš§é“æˆ–è½»é‡SOCKS5å®¹å™¨æ›´çµæ´»ã€‚</li><li><strong>è·¨å¹³å°å…¼å®¹</strong>ï¼šä¼ ç»ŸSOCKS5ä»£ç†é€‚é…æ€§æœ€å¹¿ï¼ˆå¦‚æ”¯æŒæ¸¸æˆå®¢æˆ·ç«¯ï¼‰ã€‚</li></ul>`,248)])])}const k=i(n,[["render",t]]),p=JSON.parse('{"path":"/tld/net/headscale.html","title":"Headscale","lang":"zh-CN","frontmatter":{"description":"Headscale Headscale æ˜¯ä¸€æ¬¾å¼€æºè‡ªæ‰˜ç®¡çš„ Tailscale ä¸€ã€ç½‘ç»œä¸»æµå·¥å…·é€‰å‹å¯¹æ¯” æ·±å…¥å­¦ä¹ https://headscale.net/stable/ref/configuration/ Usage https://headscale.net/stable/usage/getting-started/ æœ¬èº«æ”¯æŒRemote CLI...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Headscale\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-09-10T14:21:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"SecCMD\\",\\"url\\":\\"https://www.seccmd.net\\"}]}"],["meta",{"property":"og:url","content":"https://www.seccmd.net/tld/net/headscale.html"}],["meta",{"property":"og:site_name","content":"æ˜å‰‘å®éªŒå®¤"}],["meta",{"property":"og:title","content":"Headscale"}],["meta",{"property":"og:description","content":"Headscale Headscale æ˜¯ä¸€æ¬¾å¼€æºè‡ªæ‰˜ç®¡çš„ Tailscale ä¸€ã€ç½‘ç»œä¸»æµå·¥å…·é€‰å‹å¯¹æ¯” æ·±å…¥å­¦ä¹ https://headscale.net/stable/ref/configuration/ Usage https://headscale.net/stable/usage/getting-started/ æœ¬èº«æ”¯æŒRemote CLI..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-09-10T14:21:13.000Z"}],["meta",{"property":"article:modified_time","content":"2025-09-10T14:21:13.000Z"}]]},"git":{"createdTime":1757419694000,"updatedTime":1757514073000,"contributors":[{"name":"fireadm","username":"fireadm","email":"iwanwu@hotmail.com","commits":2,"url":"https://github.com/fireadm"}]},"readingTime":{"minutes":19.43,"words":5829},"filePathRelative":"tld/net/headscale.md","autoDesc":true}');export{k as comp,p as data};
