<!DOCTYPE html>
<html lang='zh-CN'>

<head>
  <meta name="generator" content="Hexo 6.3.0">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0">
  <meta charset="utf-8">
  

  <meta http-equiv='x-dns-prefetch-control' content='on' />
  <link rel='dns-prefetch' href='https://gcore.jsdelivr.net'>
  <link rel="preconnect" href="https://gcore.jsdelivr.net" crossorigin>
  <link rel='dns-prefetch' href='//unpkg.com'>

  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" content="#f8f8f8">
  
  <title>ç½‘ç»œé…ç½®ä¸è°ƒè¯•å…¨æ”»ç•¥ | OpenConnectã€ClashåŠç½‘ç»œå·¥å…·ä½¿ç”¨æŒ‡å— - æ•°å­—å®‰å…¨æå®¢</title>

  
    <meta name="description" content="æœ¬é¡µé¢ä¸“æ³¨äºç½‘ç»œç›¸å…³çŸ¥è¯†ï¼Œæ¶µç›–OpenConnect VPN Serverçš„å®‰è£…ä¸é…ç½®ï¼ŒåŒ…æ‹¬ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®ã€æœåŠ¡ç«¯é…ç½®å’Œé«˜çº§è·¯ç”±é…ç½®ï¼›Clashé€æ˜ä»£ç†æŠ€æœ¯åœ¨æœ¬æœºå®‰è£…ã€Tunæ¨¡å¼åŠDNSåˆ†æµçš„è¯¦ç»†è®¾ç½®ï¼Œä»¥åŠDNSç²¾å‡†åˆ†æµçš„é«˜çº§é…ç½®ï¼›Anyconnectå®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œè¿æ¥ä¸è‡ªåŠ¨ç™»å½•è„šæœ¬ï¼›ç½‘ç»œè°ƒè¯•æ–¹é¢ï¼Œä»‹ç»äº†Network Toolsã€Tcpdumpã€Routeã€Iptablesç­‰å·¥å…·çš„åŸº">
<meta property="og:type" content="article">
<meta property="og:title" content="ç½‘ç»œé…ç½®ä¸è°ƒè¯•å…¨æ”»ç•¥ | OpenConnectã€ClashåŠç½‘ç»œå·¥å…·ä½¿ç”¨æŒ‡å—">
<meta property="og:url" content="http://example.com/2024/01/01/basetools/Network/index.html">
<meta property="og:site_name" content="æ•°å­—å®‰å…¨æå®¢">
<meta property="og:description" content="æœ¬é¡µé¢ä¸“æ³¨äºç½‘ç»œç›¸å…³çŸ¥è¯†ï¼Œæ¶µç›–OpenConnect VPN Serverçš„å®‰è£…ä¸é…ç½®ï¼ŒåŒ…æ‹¬ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®ã€æœåŠ¡ç«¯é…ç½®å’Œé«˜çº§è·¯ç”±é…ç½®ï¼›Clashé€æ˜ä»£ç†æŠ€æœ¯åœ¨æœ¬æœºå®‰è£…ã€Tunæ¨¡å¼åŠDNSåˆ†æµçš„è¯¦ç»†è®¾ç½®ï¼Œä»¥åŠDNSç²¾å‡†åˆ†æµçš„é«˜çº§é…ç½®ï¼›Anyconnectå®¢æˆ·ç«¯çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œè¿æ¥ä¸è‡ªåŠ¨ç™»å½•è„šæœ¬ï¼›ç½‘ç»œè°ƒè¯•æ–¹é¢ï¼Œä»‹ç»äº†Network Toolsã€Tcpdumpã€Routeã€Iptablesç­‰å·¥å…·çš„åŸº">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-01-01T00:00:00.000Z">
<meta property="article:modified_time" content="2025-01-22T14:15:53.085Z">
<meta property="article:author" content="SecAdmin">
<meta property="article:tag" content="VPNé…ç½®">
<meta property="article:tag" content="é€æ˜ä»£ç†">
<meta property="article:tag" content="ç½‘ç»œè°ƒè¯•å·¥å…·">
<meta name="twitter:card" content="summary">
  
  
  
  <meta name="keywords" content="VPNé…ç½®,é€æ˜ä»£ç†,ç½‘ç»œè°ƒè¯•å·¥å…·">

  <!-- feed -->
  

  
    
<link rel="stylesheet" href="/css/main.css">

  

  
    <link rel="shortcut icon" href="/assets/logo.ico">
  

  

  


  
    
      <link rel="preconnect" href="https://gcore.jsdelivr.net">
    
      <link rel="stylesheet" href="https://gcore.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.1.0/lxgwwenkaiscreen.css" media="all">
    
      <script>var _hmt = _hmt || [];(function() {  var hm = document.createElement("script");  hm.src = "https://hm.baidu.com/hm.js?471fac1b9a27585ef00b1647ef02618e";  var s = document.getElementsByTagName("script")[0];   s.parentNode.insertBefore(hm, s);})();</script>
    
      <!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-3CKX8MZFEY"></script><script>  window.dataLayer = window.dataLayer || [];  function gtag(){dataLayer.push(arguments);}  gtag('js', new Date());  gtag('config', 'G-3CKX8MZFEY');</script>
    
      <!-- Google ADS google.com/adsense/ --><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9718108884365672" crossorigin="anonymous"></script>
    
  
</head>

<body>
  




  <div class='l_body' id='start'>
    <aside class='l_left' layout='post'>
    

  

<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="/assets/logo.png" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.4/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">æ•°å­—å®‰å…¨æå®¢</div><div class="sub normal cap">ä¸“æ³¨å®æˆ˜å®‰å…¨é˜²å¾¡ä½“ç³»</div><div class="sub hover cap" style="opacity:0"> Digital Security Geek</div></a></div>

<nav class="menu dis-select"></nav>
</header>


<div class="widgets">
<widget class="widget-wrapper search"><div class="widget-body"><div class="search-wrapper" id="search"><form class="search-form"><input type="text" class="search-input" id="search-input" data-filter="/blog/" placeholder="æ–‡ç« æœç´¢"><svg t="1670596976048" class="icon search-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2676" width="200" height="200"><path d="M938.2 832.6L723.8 618.1c-2.5-2.5-5.3-4.4-7.9-6.4 36.2-55.6 57.3-121.8 57.3-193.1C773.3 222.8 614.6 64 418.7 64S64 222.8 64 418.6c0 195.9 158.8 354.6 354.6 354.6 71.3 0 137.5-21.2 193.2-57.4 2 2.7 3.9 5.4 6.3 7.8L832.5 938c14.6 14.6 33.7 21.9 52.8 21.9 19.1 0 38.2-7.3 52.8-21.8 29.2-29.1 29.2-76.4 0.1-105.5M418.7 661.3C284.9 661.3 176 552.4 176 418.6 176 284.9 284.9 176 418.7 176c133.8 0 242.6 108.9 242.6 242.7 0 133.7-108.9 242.6-242.6 242.6" p-id="2677"></path></svg></form><div id="search-result"></div><div class="search-no-result">æ²¡æœ‰æ‰¾åˆ°å†…å®¹ï¼</div></div></div></widget>


<widget class="widget-wrapper toc single" id="data-toc"><div class="widget-header cap dis-select"><span class="name">ç½‘ç»œé…ç½®ä¸è°ƒè¯•å…¨æ”»ç•¥ | OpenConnectã€ClashåŠç½‘ç»œå·¥å…·ä½¿ç”¨æŒ‡å—</span></div><div class="widget-body fs14"><div class="doc-tree active"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-text">å‚è€ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-OpenConnect-VPN-Server"><span class="toc-text">å®‰è£… OpenConnect VPN Server</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%BD%91%E7%BB%9C%E8%BD%AC%E5%8F%91%E9%85%8D%E7%BD%AE"><span class="toc-text">ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-%E9%AB%98%E7%BA%A7%E8%B7%AF%E7%94%B1"><span class="toc-text">é…ç½® é«˜çº§è·¯ç”±</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8D%8E-x3D-x3D-x3D-x3D-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86-x3D-x3D-x3D-x3D"><span class="toc-text">ğŸ&#x3D;&#x3D;&#x3D;&#x3D;é€æ˜ä»£ç†&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clash-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF-%E6%9C%AC%E6%9C%BA%E5%AE%89%E8%A3%85"><span class="toc-text">Clash é€æ˜ä»£ç†æŠ€æœ¯ - æœ¬æœºå®‰è£…</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clash-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF-Tun-%E6%A8%A1%E5%BC%8F"><span class="toc-text">Clash é€æ˜ä»£ç†æŠ€æœ¯ - Tun æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clash-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF-DNS-%E5%88%86%E6%B5%81"><span class="toc-text">Clash é€æ˜ä»£ç†æŠ€æœ¯ - DNS åˆ†æµ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS-%E7%B2%BE%E5%87%86%E5%88%86%E6%B5%81-%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE"><span class="toc-text">DNS ç²¾å‡†åˆ†æµ - é«˜çº§é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Anyconnect-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">Anyconnect  å®¢æˆ·ç«¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Anyconnect-%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BD%BF%E7%94%A8"><span class="toc-text">Anyconnect  å‘½ä»¤è¡Œä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%F0%9F%8D%8E-x3D-x3D-x3D-x3D-%E7%BD%91%E7%BB%9C%E8%B0%83%E8%AF%95-x3D-x3D-x3D-x3D"><span class="toc-text">ğŸ&#x3D;&#x3D;&#x3D;&#x3D;ç½‘ç»œè°ƒè¯•&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Network-Tools"><span class="toc-text">Network Tools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tcpdump-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">Tcpdump åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Route-%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-text">Route åŸºç¡€æ“ä½œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Iptables-%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-text">Iptables ç¤ºæ„å›¾</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Iptables-Debug"><span class="toc-text">Iptables Debug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Iptables-tproxy-%E9%80%8F%E6%98%8E%E4%BB%A3%E7%90%86%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86"><span class="toc-text">Iptables tproxy é€æ˜ä»£ç†æŠ€æœ¯åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8"><span class="toc-text">ç«¯å£å¤ç”¨</span></a></li></ol></li></ol></div></div></widget>




</div>
<footer class="footer dis-select"><div class="social-wrap"><a class="social" href="/" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16"><path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L8 2.207l6.646 6.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.707 1.5Z"/> <path d="m8 3.293 6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6Z"/></svg></a><a class="social" href="https://github.com/seccmd" target="_blank" rel="external nofollow noopener noreferrer"><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/social/08a41b181ce68.svg"/></a><a class="social" href="https://twitter.com/sec_cmd" target="_blank" rel="external nofollow noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-twitter" viewBox="0 0 16 16">  <path d="M5.026 15c6.038 0 9.341-5.003 9.341-9.334 0-.14 0-.282-.006-.422A6.685 6.685 0 0 0 16 3.542a6.658 6.658 0 0 1-1.889.518 3.301 3.301 0 0 0 1.447-1.817 6.533 6.533 0 0 1-2.087.793A3.286 3.286 0 0 0 7.875 6.03a9.325 9.325 0 0 1-6.767-3.429 3.289 3.289 0 0 0 1.018 4.382A3.323 3.323 0 0 1 .64 6.575v.045a3.288 3.288 0 0 0 2.632 3.218 3.203 3.203 0 0 1-.865.115 3.23 3.23 0 0 1-.614-.057 3.283 3.283 0 0 0 3.067 2.277A6.588 6.588 0 0 1 .78 13.58a6.32 6.32 0 0 1-.78-.045A9.344 9.344 0 0 0 5.026 15z"/></svg></a><a class="social" href="https://123.seccmd.net" target="_blank" rel="external nofollow noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tools" viewBox="0 0 16 16"><path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.27 3.27a.997.997 0 0 0 1.414 0l1.586-1.586a.997.997 0 0 0 0-1.414l-3.27-3.27a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0Zm9.646 10.646a.5.5 0 0 1 .708 0l2.914 2.915a.5.5 0 0 1-.707.707l-2.915-2.914a.5.5 0 0 1 0-.708ZM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11Z"/></svg></a></div></footer>

    </aside>
    <div class='l_main'>
      

      



<div class="bread-nav fs12"><div id="breadcrumb"><a class="cap breadcrumb" href="/">ä¸»é¡µ</a><span class="sep"></span><a class="cap breadcrumb" href="/">æ–‡ç« </a><span class="sep"></span><a class="cap breadcrumb-link" href="/categories/%E7%BD%91%E7%BB%9C%E5%B7%A5%E5%85%B7/">ç½‘ç»œå·¥å…·</a></div><div id="post-meta">å‘å¸ƒäº&nbsp;<time datetime="2024-01-01T00:00:00.000Z">2024-01-01</time></div></div>

<article class='md-text content post'>
<h1 class="article-title"><span>ç½‘ç»œé…ç½®ä¸è°ƒè¯•å…¨æ”»ç•¥ | OpenConnectã€ClashåŠç½‘ç»œå·¥å…·ä½¿ç”¨æŒ‡å—</span></h1>
<h1 id="Network"><a href="#Network" class="headerlink" title="Network"></a>Network</h1><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://www.linuxbabe.com/ubuntu/openconnect-vpn-server-ocserv-ubuntu-20-04-lets-encrypt">https://www.linuxbabe.com/ubuntu/openconnect-vpn-server-ocserv-ubuntu-20-04-lets-encrypt</a><br><a target="_blank" rel="noopener" href="https://www.vultr.com/docs/setup-openconnect-vpn-server-for-cisco-anyconnect-on-ubuntu-14-04-x64/">https://www.vultr.com/docs/setup-openconnect-vpn-server-for-cisco-anyconnect-on-ubuntu-14-04-x64/</a></p>
<p>è¸©äº†ä¸€ä¸ªå‘ ubuntu22 å®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯ æŠ¥é”™ï¼Œ ç”¨ ubuntu 20 æ­£å¸¸ã€‚</p>
<h2 id="å®‰è£…-OpenConnect-VPN-Server"><a href="#å®‰è£…-OpenConnect-VPN-Server" class="headerlink" title="å®‰è£… OpenConnect VPN Server"></a>å®‰è£… OpenConnect VPN Server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¾ˆå…¨é¢çš„æ–‡ç« ï¼Œå®‰è£…å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å’Œå…è´¹è¯ä¹¦ - https://www.linuxbabe.com/ubuntu/openconnect-vpn-server-ocserv-ubuntu-20-04-lets-encrypt</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install ocserv</span><br><span class="line"><span class="built_in">sudo</span> systemctl status ocserv</span><br><span class="line"><span class="built_in">sudo</span> systemctl start ocserv</span><br></pre></td></tr></table></figure>

<h2 id="ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®"><a href="#ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®" class="headerlink" title="ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®"></a>ç³»ç»Ÿç½‘ç»œè½¬å‘é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line">iptables -t nat -A POSTROUTING -j MASQUERADE     <span class="comment">## Enable NAT.</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;net.ipv4.ip_forward=1&quot;</span> &gt;&gt; /etc/sysctl.conf <span class="comment">## Enable IPv4 forwarding. Edit the file /etc/sysctl.conf.</span></span><br><span class="line">sysctl -p /etc/sysctl.conf                       <span class="comment">## Apply this modification.</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;nameserver 8.8.8.8&#x27;</span> &gt; /etc/resolv.conf     <span class="comment">## ä¸´æ—¶ä¿®æ”¹ DNS é…ç½®</span></span><br><span class="line"><span class="comment">## æ°¸ä¹…ä¿®æ”¹ DNS é…ç½®</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install resolvconf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;nameserver 8.8.8.8&#x27;</span> &gt;&gt; /etc/resolvconf/resolv.conf.d/head</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;nameserver 1.1.1.1&#x27;</span> &gt;&gt; /etc/resolvconf/resolv.conf.d/head</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> --now resolvconf.service</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line"><span class="comment">## é…ç½® æœåŠ¡ç«¯</span></span><br><span class="line">``` bash</span><br><span class="line">vi /etc/ocserv/ocserv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç›‘å¬ç«¯å£</span></span><br><span class="line">tcp-port = 1443</span><br><span class="line">udp-port = 1443</span><br><span class="line"></span><br><span class="line"><span class="comment">## DNS é…ç½®</span></span><br><span class="line">tunnel-all-dns = <span class="literal">true</span></span><br><span class="line">dns = 8.8.8.8</span><br><span class="line"></span><br><span class="line"><span class="comment">## VPN è´¦å·</span></span><br><span class="line">auth = <span class="string">&quot;pam[gid-min=1000]&quot;</span>  <span class="comment"># ç›´æ¥ä½¿ç”¨ Linux ç³»ç»Ÿè´¦å·</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ocserv é‡å¯æœåŠ¡</span></span><br><span class="line"><span class="built_in">sudo</span> systemctl restart ocserv</span><br><span class="line"><span class="built_in">sudo</span> systemctl restart ocserv.socket</span><br><span class="line"></span><br><span class="line"><span class="comment">## ï¼ç›‘å¬ç«¯å£æ•…éšœï¼Œä¿®æ”¹ ocserv.conf ç›‘å¬æ–­å¼€é…ç½®æ— æ•ˆï¼ŒåŒæ—¶éœ€è¦ä¿®æ”¹ç³»ç»ŸæœåŠ¡é…ç½® ocserv.socket</span></span><br><span class="line"><span class="comment">## ocserv ç³»ç»ŸæœåŠ¡æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">cat</span> /lib/systemd/system/ocserv.socket</span><br><span class="line">[Unit]</span><br><span class="line">Description=OpenConnect SSL VPN server Socket</span><br><span class="line">[Socket]</span><br><span class="line">ListenStream=443</span><br><span class="line">ListenDatagram=443</span><br><span class="line">BindIPv6Only=default</span><br><span class="line">Accept=<span class="literal">false</span></span><br><span class="line">ReusePort=<span class="literal">true</span></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=sockets.target</span><br></pre></td></tr></table></figure>



<h2 id="é…ç½®-é«˜çº§è·¯ç”±"><a href="#é…ç½®-é«˜çº§è·¯ç”±" class="headerlink" title="é…ç½® é«˜çº§è·¯ç”±"></a>é…ç½® é«˜çº§è·¯ç”±</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## é«˜çº§é…ç½®</span></span><br><span class="line">- https://www.linuxbabe.com/linux-server/ocserv-openconnect-vpn-advanced</span><br><span class="line"></span><br><span class="line"><span class="comment">## ç»™ç‰¹å®šç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œé…ç½®å®šåˆ¶çš„è·¯ç”±ç­–ç•¥</span></span><br><span class="line"><span class="comment">### æ–°å»ºç”¨æˆ· vpnuser</span></span><br><span class="line">useradd vpnuser</span><br><span class="line">passwd vpnuser</span><br><span class="line"></span><br><span class="line"><span class="comment">### /etc/ocserv/ocserv.conf ä¸»é…ç½®æ–‡ä»¶æ·»åŠ ï¼Œç‹¬ç«‹é…ç½®ç›®å½• </span></span><br><span class="line">config-per-user = /etc/ocserv/config-per-user/</span><br><span class="line">config-per-group = /etc/ocserv/config-per-group/</span><br><span class="line"></span><br><span class="line"><span class="comment">### ç»™ç‰¹å®šç”¨æˆ·æˆ–ç”¨æˆ·ç»„ï¼Œåˆ›å»ºç‹¬ç«‹é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> /etc/ocserv/config-per-user/</span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">mkdir</span> /etc/ocserv/config-per-group/</span><br><span class="line"><span class="built_in">sudo</span> vi /etc/ocserv/config-per-user/user1</span><br><span class="line"><span class="built_in">sudo</span> vi /etc/ocserv/config-per-group/group1</span><br><span class="line"><span class="comment"># ä¾‹å¦‚ï¼šæˆ‘åˆšæ‰åˆ›å»ºçš„ç”¨æˆ·åä¸ºï¼švpnuser</span></span><br><span class="line"><span class="built_in">sudo</span> vi /etc/ocserv/config-per-user/vpnuser</span><br><span class="line"></span><br><span class="line"><span class="comment">## é…ç½®å†…ç½‘çš„è·¯ç”±åœ°å€æ±  Secured Routes (IPv4)</span></span><br><span class="line">route = 10.16.0.0/13</span><br><span class="line"></span><br><span class="line"><span class="comment">## æµé‡åˆ†å‰²ï¼ˆå›½å†…ç½‘æ®µä¸èµ°è·¯ç”±ï¼‰</span></span><br><span class="line">åªé…ç½® route = xx è¯´æ˜å“ªäº›åœ°å€èµ°VPNï¼Œå…¶ä½™ä¸èµ°VPNã€‚ä¾‹å¦‚ï¼šåªæœ‰å›½å¤–åœ°å€æ‰èµ°VPNï¼ˆroute=ï¼‰ï¼Œå…¶ä½™éƒ½ä¸èµ°VPNã€‚</span><br><span class="line">åªé…ç½® no-route = xx è¯´æ˜å“ªäº›åœ°å€ä¸èµ°VPNï¼Œå…¶ä½™å…¨èµ°VPNã€‚ä¾‹å¦‚ï¼šåªæœ‰å›½å†…ä¸èµ°VPNï¼ˆno-reoute=ï¼‰ï¼Œå…¶ä½™éƒ½èµ°VPNã€‚</span><br><span class="line"></span><br><span class="line"><span class="comment">## æœ€å°åŒ–çš„å›½å†…è·¯ç”±æ®µ</span></span><br><span class="line"><span class="comment">## ocservä¸‹å‘çš„è·¯ç”±è¡¨æœ€å¤šæ”¯æŒä¸‹å‘**200**æ¡è·¯ç”±è¡¨ã€‚ä¸ºäº†å°½å¯èƒ½çš„åœ¨200æ¡è·¯ç”±è¡¨å†…å¡ä¸‹routeæˆ–è€…no-routeï¼Œå¤§å®¶å‘æŒ¥èªæ˜æ‰æ™ºé€šè¿‡åˆå¹¶cidræˆ–è€…æ‰©å¤§cnçš„è·¯ç”±è¡¨èŒƒå›´ç­‰æ–¹å¼ï¼Œæœ‰äº†å¾ˆå¤šä¼˜ç§€çš„no-routeè¡¨ï¼Œä¾‹å¦‚ï¼šhttps://github.com/CNMan/ocserv-cn-no-route</span></span><br></pre></td></tr></table></figure>



<h2 id="ğŸ-x3D-x3D-x3D-x3D-é€æ˜ä»£ç†-x3D-x3D-x3D-x3D"><a href="#ğŸ-x3D-x3D-x3D-x3D-é€æ˜ä»£ç†-x3D-x3D-x3D-x3D" class="headerlink" title="ğŸ&#x3D;&#x3D;&#x3D;&#x3D;é€æ˜ä»£ç†&#x3D;&#x3D;&#x3D;&#x3D;"></a>ğŸ&#x3D;&#x3D;&#x3D;&#x3D;é€æ˜ä»£ç†&#x3D;&#x3D;&#x3D;&#x3D;</h2><h2 id="Clash-é€æ˜ä»£ç†æŠ€æœ¯-æœ¬æœºå®‰è£…"><a href="#Clash-é€æ˜ä»£ç†æŠ€æœ¯-æœ¬æœºå®‰è£…" class="headerlink" title="Clash é€æ˜ä»£ç†æŠ€æœ¯ - æœ¬æœºå®‰è£…"></a>Clash é€æ˜ä»£ç†æŠ€æœ¯ - æœ¬æœºå®‰è£…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›®çš„ï¼šOpenConnect çš„æµé‡åˆ†å‰²é…ç½®ï¼Œç”±äºå›½å®¶IPç½‘æ®µæ•°é‡åºå¤§ï¼Œä¼šåœ¨ä¸ªäººç”µè„‘æ’å…¥å¤§é‡çš„é™æ€è·¯ç”±ï¼Œæ€§èƒ½ä¸å¥½è¯´ï¼Œå¾ˆä¸ç§‘æŠ€ã€‚</span></span><br><span class="line"><span class="comment">## å¦å¤–ï¼Œè´­ä¹°çš„æ”¶è´¹æœåŠ¡ï¼Œå®ç°äº†å¾ˆå¥½çš„åˆ†å‰²ï¼Œæˆ‘æ¨¡ä»¿å®ƒä¸€ç›´æ²¡åšåˆ°ï¼Œæœ€åå‘ç°å®ƒä½¿ç”¨çš„ä¸æ˜¯ é»˜è®¤çš„æµé‡åˆ†å‰²æŠ€æœ¯ï¼Œæ‰€ä»¥å¼€å§‹è¿›ä¸€æ­¥æ¢ç´¢ã€‚</span></span><br><span class="line"><span class="comment">## èŠ±äº†å¾ˆé•¿æ—¶é—´ï¼Œæœ€åå®šä½åˆ°ï¼šé€æ˜ä»£ç†æŠ€æœ¯ fake-ip: ä¼ªé€ IPæ¨¡å¼ã€‚clashçš„fake-ipæŠ€æœ¯ / v2rayçš„fake DNSæŠ€æœ¯</span></span><br><span class="line"><span class="comment">## - https://vlike.work/tech/trans_proxy.html</span></span><br><span class="line"><span class="comment">## - https://bulianglin.com/archives/dnsproxy.html</span></span><br><span class="line"><span class="comment">## - https://blog.lv5.moe/p/use-dns-to-create-split-routing-for-different-domain-or-ip-ranges</span></span><br><span class="line"><span class="comment">## - https://gist.github.com/cld4h/9a03ec2f826a25be5ab974fdbc540de4</span></span><br><span class="line"><span class="comment">## - https://www.sobyte.net/post/2022-02/clash-tproxy/</span></span><br><span class="line"><span class="comment">## - https://xtls.github.io/document/level-2/tproxy.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## é¦–å…ˆä½ éœ€è¦éƒ¨ç½²å¥½ Clash</span></span><br><span class="line">- https://dreamacro.github.io/clash/</span><br><span class="line">wget https://github.com/Dreamacro/clash/releases/download/v1.17.0/clash-linux-amd64-v1.17.0.gz </span><br><span class="line">gunzip clash-linux-amd64-v1.17.0.gz &amp;&amp; <span class="built_in">chmod</span> +x clash-linux-amd64-v1.17.0</span><br><span class="line"></span><br><span class="line"><span class="comment">## Clash as a Service</span></span><br><span class="line"><span class="built_in">mv</span> clash-linux-amd64-v1.17.0 /usr/local/bin</span><br><span class="line"><span class="built_in">mkdir</span> /etc/clash</span><br><span class="line"><span class="built_in">touch</span> /etc/clash/config.yaml</span><br><span class="line"><span class="built_in">touch</span>  /etc/clash/Country.mmdb</span><br><span class="line"></span><br><span class="line">vi /etc/systemd/system/clash.service</span><br><span class="line">[Unit]</span><br><span class="line">Description=Clash daemon, A rule-based proxy <span class="keyword">in</span> Go.</span><br><span class="line">After=network-online.target</span><br><span class="line">[Service]</span><br><span class="line">User=clash</span><br><span class="line">Type=simple</span><br><span class="line">Restart=always</span><br><span class="line">ExecStart=/usr/local/bin/clash -d /etc/clash</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl <span class="built_in">enable</span> clash</span><br><span class="line">systemctl start clash</span><br><span class="line">systemctl status clash</span><br><span class="line">journalctl -xe | grep clash</span><br><span class="line"></span><br><span class="line"><span class="comment">## é…ç½®æ¨¡æ¿ï¼šhttps://raw.githubusercontent.com/XinSSS/Conf-for-Surge-Shadowrocket/master/clash_base.yaml</span></span><br><span class="line">clash -f /etc/clash/config.yaml</span><br><span class="line"><span class="comment"># TProxy çš„é€æ˜ä»£ç†ç«¯å£</span></span><br><span class="line">tproxy-port: 7893</span><br><span class="line"><span class="comment"># mixed-port ç«¯å£å°†åŒæ—¶æ”¯æŒ SOCKS5/HTTP</span></span><br><span class="line">mixed-port: 7890</span><br><span class="line"><span class="comment"># å…è®¸æ¥è‡ªå±€åŸŸç½‘çš„è¿æ¥</span></span><br><span class="line">allow-lan: <span class="literal">true</span></span><br><span class="line"><span class="comment"># ç»‘å®šåˆ°æ‰€æœ‰æ¥å£</span></span><br><span class="line">bind-address: <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line"><span class="comment">## ä½¿ç”¨ fake-ip æ¨¡å¼çš„ Clash æ—¢ä½œä¸ºé€æ˜ä»£ç†åˆä½œä¸º DNS Server</span></span><br><span class="line">dns:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  // å¼€å¯ fake-ip æ¨¡å¼</span><br><span class="line">  enhanced-mode: fake-ip</span><br><span class="line">  // é€‰æ‹©ä¿ç•™ ip æ®µï¼Œä¸€èˆ¬ä¿æŒé»˜è®¤å³å¯</span><br><span class="line">  fake-ip-range: 198.18.0.1/16</span><br><span class="line">  // æŒ‡å®š Clash DNS ç›‘å¬åœ°å€</span><br><span class="line">  listen: 0.0.0.0:53</span><br><span class="line">  // æŒ‡å®šä¸Šæ¸¸å…¬å…± DNS</span><br><span class="line">  nameserver:</span><br><span class="line">  - 223.5.5.5:53</span><br><span class="line">  // æ·»åŠ éœ€è¦ç›´è¿çš„å›½å†…åŸŸå</span><br><span class="line">  fake-ip-filter:</span><br><span class="line">  - baidu.com</span><br><span class="line">  - ...</span><br></pre></td></tr></table></figure>



<h2 id="Clash-é€æ˜ä»£ç†æŠ€æœ¯-Tun-æ¨¡å¼"><a href="#Clash-é€æ˜ä»£ç†æŠ€æœ¯-Tun-æ¨¡å¼" class="headerlink" title="Clash é€æ˜ä»£ç†æŠ€æœ¯ - Tun æ¨¡å¼"></a>Clash é€æ˜ä»£ç†æŠ€æœ¯ - Tun æ¨¡å¼</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/clash/config.yaml</span></span><br><span class="line"><span class="attr">dns:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">enhanced-mode:</span> <span class="string">fake-ip</span></span><br><span class="line">  <span class="attr">fake-ip-range:</span> <span class="number">198.16</span><span class="number">.0</span><span class="number">.1</span><span class="string">/16</span></span><br><span class="line">  <span class="attr">listen:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:1053</span></span><br><span class="line">  <span class="attr">nameserver:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8.8</span><span class="number">.8</span><span class="number">.8</span><span class="string">:53</span></span><br><span class="line">  <span class="attr">fake-ip-filter:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">baidu.com</span></span><br><span class="line"><span class="attr">tun:</span>  <span class="string">//</span> <span class="string">éœ€è¦</span> <span class="string">root</span> <span class="string">æƒé™</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">stack:</span> <span class="string">system</span></span><br><span class="line">  <span class="string">//</span> <span class="string">è‡ªåŠ¨ä¸º</span> <span class="string">fake-ip-range</span> <span class="string">ä¸­çš„</span> <span class="string">ip</span> <span class="string">æ®µæ·»åŠ è·¯ç”±</span></span><br><span class="line">  <span class="attr">auto-route:</span> <span class="literal">true</span>  <span class="comment"># ä½¿ç”¨ OpenConnect ocserv æ—¶ï¼Œå¼€å¯è¿™ä¸ªé…ç½®ï¼Œå°±ä¼šè·¯ç”±å¤±è´¥ï¼Œä¸å†™è¿™è¡Œè¿è¡Œæ­£å¸¸ã€‚ï¼ˆåŸå› æœªçŸ¥ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è½¬å‘ä»å±€åŸŸç½‘æ”¶åˆ°çš„æ‰€æœ‰ DNS æŸ¥è¯¢æµé‡åˆ° 1053 ç«¯å£</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-t</span> <span class="string">nat</span> <span class="string">-I</span> <span class="string">PREROUTING</span> <span class="string">-p</span> <span class="string">udp</span> <span class="string">--dport</span> <span class="number">53</span> <span class="string">-j</span> <span class="string">REDIRECT</span> <span class="string">--to</span> <span class="number">1053</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åªåŠ«æŒæŒ‡å®šåœ°å€çš„ DNS æµé‡ï¼ŒåªåŠ«æŒvpnuserçš„dns 10.10.10.1ï¼Œä¸åŠ«æŒadminçš„dns 8.8.8.8</span></span><br><span class="line"><span class="comment"># admin å…¨æµé‡å®Œå…¨ä»£ç†ï¼Œvpnuseræµé‡åˆ†æµä»£ç†</span></span><br><span class="line"><span class="string">iptables</span> <span class="string">-t</span> <span class="string">nat</span> <span class="string">-I</span> <span class="string">PREROUTING</span> <span class="string">-p</span> <span class="string">udp</span> <span class="string">--dport</span> <span class="number">53</span> <span class="string">-d</span> <span class="number">10.10</span><span class="number">.10</span><span class="number">.1</span><span class="string">/32</span> <span class="string">-j</span> <span class="string">REDIRECT</span> <span class="string">--to</span> <span class="number">1053</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Clash-é€æ˜ä»£ç†æŠ€æœ¯-DNS-åˆ†æµ"><a href="#Clash-é€æ˜ä»£ç†æŠ€æœ¯-DNS-åˆ†æµ" class="headerlink" title="Clash é€æ˜ä»£ç†æŠ€æœ¯ - DNS åˆ†æµ"></a>Clash é€æ˜ä»£ç†æŠ€æœ¯ - DNS åˆ†æµ</h2><p>æœ€å…³é”®çš„æ˜¯éœ€è¦å°†å¸¸è§å›½å†…åŸŸååŠ å…¥åˆ° fake-ip-filter ä¸­ï¼Œè¿™é‡Œæ¨èä¸€ä¸ªæ¯æ—¥æ›´æ–°å›½å†…åŸŸåçš„é¡¹ç›®ï¼š<a target="_blank" rel="noopener" href="https://github.com/felixonmars/dnsmasq-china-list">felixonmars&#x2F;dnsmasq-china-list</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æç®€é…ç½®: ä½¿ç”¨ fake-ip æ¨¡å¼çš„ Clash æ—¢ä½œä¸ºé€æ˜ä»£ç†åˆä½œä¸º DNS Serverï¼Œè¿™ç§æ–¹å¼é…ç½®éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªèƒ½è¿è¡Œ Clash çš„è®¾å¤‡å³å¯</span></span><br><span class="line">dns:</span><br><span class="line">  <span class="built_in">enable</span>: <span class="literal">true</span></span><br><span class="line">  // å¼€å¯ fake-ip æ¨¡å¼</span><br><span class="line">  enhanced-mode: fake-ip</span><br><span class="line">  // é€‰æ‹©ä¿ç•™ ip æ®µï¼Œä¸€èˆ¬ä¿æŒé»˜è®¤å³å¯</span><br><span class="line">  fake-ip-range: 198.18.0.1/16</span><br><span class="line">  // æŒ‡å®š Clash DNS ç›‘å¬åœ°å€</span><br><span class="line">  listen: 0.0.0.0:53</span><br><span class="line">  // æŒ‡å®šä¸Šæ¸¸å…¬å…± DNS</span><br><span class="line">  nameserver:</span><br><span class="line">  - 223.5.5.5:53</span><br><span class="line">  // æ·»åŠ éœ€è¦ç›´è¿çš„å›½å†…åŸŸå</span><br><span class="line">  fake-ip-filter:</span><br><span class="line">  - baidu.com</span><br><span class="line">  - ...</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å›½å†…åŸŸåçš„è„šæœ¬ï¼Œè‡ªåŠ¨ç”Ÿæˆ fake-ip-filter æ¸…å•ã€‚</span></span><br><span class="line"><span class="built_in">rm</span> -f accelerated-domains.china.conf</span><br><span class="line">wget https://raw.githubusercontent.com/felixonmars/dnsmasq-china-list/master/accelerated-domains.china.conf -O ./accelerated-domains.china.conf <span class="comment"># ä¸­å›½çš„åŸŸåæ¸…å• https://github.com/felixonmars/dnsmasq-china-list</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;</span></span><br><span class="line"><span class="string">#LAN</span></span><br><span class="line"><span class="string">*.lan</span></span><br><span class="line"><span class="string">*.localdomain</span></span><br><span class="line"><span class="string">*.example</span></span><br><span class="line"><span class="string">*.invalid</span></span><br><span class="line"><span class="string">*.localhost</span></span><br><span class="line"><span class="string">*.test</span></span><br><span class="line"><span class="string">*.local</span></span><br><span class="line"><span class="string">*.home.arpa</span></span><br><span class="line"><span class="string">#æ”¾è¡ŒNTPæœåŠ¡</span></span><br><span class="line"><span class="string">time.*.com</span></span><br><span class="line"><span class="string">time.*.gov</span></span><br><span class="line"><span class="string">time.*.edu.cn</span></span><br><span class="line"><span class="string">time.*.apple.com</span></span><br><span class="line"><span class="string">ntp.*.com</span></span><br><span class="line"><span class="string">*.time.edu.cn</span></span><br><span class="line"><span class="string">*.ntp.org.cn</span></span><br><span class="line"><span class="string">+.pool.ntp.org</span></span><br><span class="line"><span class="string">time1.cloud.tencent.com</span></span><br><span class="line"><span class="string">*.cn</span></span><br><span class="line"><span class="string">&#x27;</span> &gt; ./openclash_custom_fake_filter.list</span><br><span class="line">awk -F / <span class="string">&#x27;&#123;print &quot;+.&quot;$2&#125;&#x27;</span> ./accelerated-domains.china.conf &gt;&gt; ./openclash_custom_fake_filter.list</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;  fake-ip-filter:&#x27;</span> &gt; ./openclash_fake_filter.list</span><br><span class="line">awk <span class="string">&#x27;&#123;print &quot;    - &#x27;</span>\&#x27;<span class="string">&#x27;&quot;$1&quot;&#x27;</span>\&#x27;<span class="string">&#x27;&quot;&#125;&#x27;</span> ./openclash_custom_fake_filter.list &gt;&gt; ./openclash_fake_filter.list</span><br></pre></td></tr></table></figure>



<h2 id="DNS-ç²¾å‡†åˆ†æµ-é«˜çº§é…ç½®"><a href="#DNS-ç²¾å‡†åˆ†æµ-é«˜çº§é…ç½®" class="headerlink" title="DNS ç²¾å‡†åˆ†æµ - é«˜çº§é…ç½®"></a>DNS ç²¾å‡†åˆ†æµ - é«˜çº§é…ç½®</h2><ul>
<li><a target="_blank" rel="noopener" href="https://blog.lv5.moe/p/use-dns-to-create-split-routing-for-different-domain-or-ip-ranges">https://blog.lv5.moe/p/use-dns-to-create-split-routing-for-different-domain-or-ip-ranges</a></li>
</ul>
<p>ä½¿ç”¨ Clash DNS çš„æ–¹æ¡ˆè™½ç„¶é…ç½®éå¸¸ç®€å•ï¼Œä½†æ˜¯æ¯•ç«Ÿä¸å¯èƒ½å°†æ‰€æœ‰å›½å†…åŸŸåéƒ½ç»Ÿè®¡å‡ºæ¥ï¼Œè¿˜éœ€è¦æ ¹æ® ip è¿›è¡Œæ›´ç²¾å‡†çš„åˆ†æµ</p>
<p><a target="_blank" rel="noopener" href="https://github.com/IrineSistiana/mosdns-cn">IrineSistiana&#x2F;mosdns-cn</a> ä½œä¸ºåˆ†æµ DNSï¼Œè¿™é‡Œå¼•ç”¨ mosdns-cn å®˜æ–¹æ–‡æ¡£ä¸Šä»‹ç»çš„åˆ†æµè§„åˆ™</p>
<p>è‡ªå·±å‰é¢å¥—ä¸ª mosdns v4 ï¼ˆv5ç æ‰äº†geosite&#x2F;geoipèµ„æºæ–‡ä»¶æ”¯æŒ, ç”¨èµ·æ¥æ›´éº»çƒ¦ç‚¹ï¼‰</p>
<p>TODO: æœ‰å¾…è¿›ä¸€æ­¥ç ”ç©¶</p>
<h2 id="Anyconnect-å®¢æˆ·ç«¯"><a href="#Anyconnect-å®¢æˆ·ç«¯" class="headerlink" title="Anyconnect  å®¢æˆ·ç«¯"></a>Anyconnect  å®¢æˆ·ç«¯</h2><p>å®¢æˆ·ç«¯ä¸‹è½½ï¼šanyconnect<br><a target="_blank" rel="noopener" href="https://devops-100tal.oss-cn-beijing.aliyuncs.com/vpnuserguide/vpnuserguide.htm">https://devops-100tal.oss-cn-beijing.aliyuncs.com/vpnuserguide/vpnuserguide.htm</a></p>
<h2 id="Anyconnect-å‘½ä»¤è¡Œä½¿ç”¨"><a href="#Anyconnect-å‘½ä»¤è¡Œä½¿ç”¨" class="headerlink" title="Anyconnect  å‘½ä»¤è¡Œä½¿ç”¨"></a>Anyconnect  å‘½ä»¤è¡Œä½¿ç”¨</h2><p>**ä½¿ç”¨è„šæœ¬è‡ªåŠ¨ç™»å½•VPN **</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨è„šæœ¬è‡ªåŠ¨ç™»å½•VPN &gt; To connect VPN via CMD</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## ä¸€å¥è¯æ‰§è¡Œï¼šc2v.bat</span></span><br><span class="line">REM ç¬¬ä¸€æ­¥ï¼šå…³é—­ AnyConnect å›¾å½¢ç•Œé¢</span><br><span class="line">taskkill /F /IM vpnui.exe /T</span><br><span class="line"></span><br><span class="line">REM ç¬¬äºŒæ­¥ï¼šå…³é—­å·²æœ‰çš„ AnyConnect è¿æ¥</span><br><span class="line"><span class="string">&quot;C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client&quot;</span>\vpncli.exe disconnect</span><br><span class="line"></span><br><span class="line">REM ç¬¬ä¸‰æ­¥ï¼šè¯»å–é…ç½®æ–‡ä»¶è‡ªåŠ¨è¿æ¥</span><br><span class="line"><span class="string">&quot;C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client&quot;</span>\vpncli.exe <span class="literal">-s</span> &lt; %USERPROFILE%\Videos\CWork\Topic\vpnfile.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">## é…ç½®æ–‡ä»¶æ ¼å¼</span></span><br><span class="line">.\vpncli.exe <span class="literal">-s</span> &lt; response.txt</span><br><span class="line">&gt; Template File</span><br><span class="line">&gt; connect &lt;host&gt;                    <span class="comment"># ä¾‹å¦‚ï¼šconnect connect2vinoth.com</span></span><br><span class="line">&gt; [<span class="type">Optional</span>: <span class="type">drop</span> <span class="type">down</span> <span class="type">selection</span>]   <span class="comment"># è¿™é‡Œé€‰æ‹©éªŒè¯æ–¹å¼ï¼Œé€‰ç¬¬ä¸€ç§æ–¹å¼è¾“å…¥ï¼š0ï¼Œæ²¡æœ‰çš„è¯åˆ é™¤æœ¬è¡Œ</span></span><br><span class="line">&gt; &lt;username&gt;                        <span class="comment"># ä¾‹å¦‚ï¼šmyuser</span></span><br><span class="line">&gt; &lt;password&gt;                        <span class="comment"># ä¾‹å¦‚ï¼šmypass</span></span><br></pre></td></tr></table></figure>



<p><strong>To connect VPN via CMD</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> <span class="string">&quot;C:\Program Files (x86)\Cisco\Cisco AnyConnect Secure Mobility Client&quot;</span></span><br><span class="line">.\vpncli.exe <span class="literal">-h</span></span><br><span class="line">    Usage: vpncli.exe [<span class="type">options</span>] | [<span class="type">cmd</span>] [<span class="type">host</span>]</span><br><span class="line">       commands: [<span class="type">connect</span>|<span class="type">disconnect</span>|<span class="type">hosts</span>|<span class="type">state</span>|<span class="type">stats</span>]</span><br><span class="line">       options:</span><br><span class="line">            <span class="literal">-h</span>         Print this usage statement.</span><br><span class="line">            <span class="literal">-v</span>         Print version.</span><br><span class="line">            <span class="literal">-s</span>         Read commands from response file to work non<span class="literal">-interactively</span>.</span><br><span class="line">                       Example: vpncli.exe <span class="literal">-s</span> &lt; response.txt</span><br><span class="line">.\vpncli.exe disconnect  <span class="comment"># æ–­å¼€è¿æ¥</span></span><br><span class="line"></span><br><span class="line">.\vpncli.exe connect xytth.com:<span class="number">1443</span>  <span class="comment"># å¦‚æœæ‰“å¼€äº†å›¾å½¢ç•Œé¢ä¼šæŠ¥é”™ error: Connect not available. Another AnyConnect application is running</span></span><br><span class="line"></span><br><span class="line"> .\vpncli.exe state   <span class="comment"># æŸ¥çœ‹è¿æ¥çŠ¶æ€</span></span><br><span class="line">  &gt;&gt; state: Connected</span><br><span class="line">  &gt;&gt; state: Connected</span><br><span class="line">  &gt;&gt; state: Connected</span><br><span class="line">  &gt;&gt; registered with local VPN subsystem.</span><br><span class="line"></span><br><span class="line">.\vpncli.exe stats   <span class="comment"># æŸ¥çœ‹è¿æ¥è¯¦æƒ…</span></span><br><span class="line"></span><br><span class="line">REF: </span><br><span class="line"></span><br><span class="line">- [<span class="type">Connecting</span> <span class="type">to</span> <span class="type">AnyConnect</span> <span class="type">via</span> <span class="type">Command</span> <span class="type">Line</span> <span class="type">on</span> <span class="type">Windows</span>](https://it.umn.edu/services<span class="literal">-technologies</span>/how<span class="literal">-tos</span>/virtual<span class="literal">-private-network-vpn-advanced-0</span>)</span><br><span class="line">- [<span class="type">Connecting</span> <span class="type">CiscoAnyConnectVPN</span> <span class="type">via</span> <span class="type">bash</span> <span class="type">script</span> <span class="type">in</span> <span class="type">Windows</span>](https://medium.com/@vinothkumarsubbu/connecting<span class="literal">-ciscoanyconnectvpn-via-bash-script-in-windows-f749e706d115</span>)</span><br></pre></td></tr></table></figure>




<h2 id="ğŸ-x3D-x3D-x3D-x3D-ç½‘ç»œè°ƒè¯•-x3D-x3D-x3D-x3D"><a href="#ğŸ-x3D-x3D-x3D-x3D-ç½‘ç»œè°ƒè¯•-x3D-x3D-x3D-x3D" class="headerlink" title="ğŸ&#x3D;&#x3D;&#x3D;&#x3D;ç½‘ç»œè°ƒè¯•&#x3D;&#x3D;&#x3D;&#x3D;"></a>ğŸ&#x3D;&#x3D;&#x3D;&#x3D;ç½‘ç»œè°ƒè¯•&#x3D;&#x3D;&#x3D;&#x3D;</h2><h2 id="Network-Tools"><a href="#Network-Tools" class="headerlink" title="Network Tools"></a>Network Tools</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.redhat.com/sysadmin/beginners-guide-network-troubleshooting-linux</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Layer 1: The physical layer</span></span><br><span class="line">ip <span class="built_in">link</span> show</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 up</span><br><span class="line">ip -br <span class="built_in">link</span> show</span><br><span class="line">ip -s <span class="built_in">link</span> show eth0</span><br><span class="line">ethtool eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Layer 2: The data link layer</span></span><br><span class="line">ip neighbor show</span><br><span class="line"></span><br><span class="line"><span class="comment"># Layer 3: The network/internet layer</span></span><br><span class="line">ip -br address show</span><br><span class="line">ping www.google.com</span><br><span class="line">traceroute www.google.com</span><br><span class="line">ip route show</span><br><span class="line">nslookup www.google.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Layer 4: The transport layer</span></span><br><span class="line">telnet database.example.com 3306</span><br><span class="line">nc 192.168.122.1 -u 80</span><br><span class="line">ss -tunlp4</span><br><span class="line">Letâ€™s <span class="built_in">break</span> down these flags:</span><br><span class="line">-t - Show TCP ports.</span><br><span class="line">-u - Show UDP ports.</span><br><span class="line">-n - Do not try to resolve hostnames.</span><br><span class="line">-l - Show only listening ports.</span><br><span class="line">-p - Show the processes that are using a particular socket.</span><br><span class="line">-4 - Show only IPv4 sockets.</span><br></pre></td></tr></table></figure>



<h2 id="Tcpdump-åŸºæœ¬ä½¿ç”¨"><a href="#Tcpdump-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="Tcpdump åŸºæœ¬ä½¿ç”¨"></a>Tcpdump åŸºæœ¬ä½¿ç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŠ“å–æ‰€æœ‰çš„åŒ… tcpdump</span></span><br><span class="line">tcpdump -i eth0  <span class="comment"># ç›‘å¬ç‰¹å®šçš„ç½‘å¡</span></span><br><span class="line">tcpdump host hostname      <span class="comment"># æºå’Œç›®çš„ä¸ºè¯¥ipçš„éƒ½ç›‘å¬</span></span><br><span class="line">tcpdump src host hostname  <span class="comment"># æ¥æºæ˜¯æŒ‡å®šä¸»æœº</span></span><br><span class="line">tcpdump dst host hostname  <span class="comment"># ç›®æ ‡æ˜¯æŒ‡å®šä¸»æœº</span></span><br><span class="line">tcpdump port 80            <span class="comment"># ç›‘å¬ç‰¹å®šçš„ç«¯å£</span></span><br><span class="line">tcpdump src port 443       <span class="comment"># æ¥æºæ˜¯æŒ‡å®šç«¯å£</span></span><br><span class="line">tcpdump dst port 443       <span class="comment"># ç›®æ ‡æ˜¯æŒ‡å®šç«¯å£</span></span><br><span class="line">tcpdump src portrange 4000-5000    <span class="comment"># è®¾ç½®ç›‘å¬çš„ç«¯å£èŒƒå›´</span></span><br><span class="line">tcpdump src net 192.168.50.0/24    <span class="comment"># æŒ‡å®šç½‘æ®µæŠ“åŒ…</span></span><br><span class="line">tcpdump ip|ip6|tcp|udp|icmp        <span class="comment"># æŠ“å–æŒ‡å®šåè®®çš„æ•°æ®åŒ…</span></span><br><span class="line"></span><br><span class="line">tcpdump ip host 210.27.48.1 and ! 210.27.48.2</span><br><span class="line">tcpdump tcp port 23 and host 210.27.48.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># Flags [ ]ï¼šFlagsä»£è¡¨äº†è¿™ä¸ªæ•°æ®åŒ…çš„ç”¨é€”</span></span><br><span class="line">[S]	    SYNåŒæ­¥æ ‡è¯†</span><br><span class="line">[.]	    .è¡¨ç¤ºACKç¡®è®¤æ ‡è¯†</span><br><span class="line">[S.]	SYNåŒæ­¥æ ‡è¯†ï¼Œä»¥åŠç¡®è®¤[S]çš„ACK</span><br><span class="line">[P.]	PSHï¼Œpushæ¨é€ï¼Œæ•°æ®ä¼ è¾“</span><br><span class="line">[R.]	RSTï¼Œè¿æ¥é‡ç½®</span><br><span class="line">[F.]	FINç»“æŸè¿æ¥</span><br></pre></td></tr></table></figure>

<h2 id="Route-åŸºç¡€æ“ä½œ"><a href="#Route-åŸºç¡€æ“ä½œ" class="headerlink" title="Route åŸºç¡€æ“ä½œ"></a>Route åŸºç¡€æ“ä½œ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ip route add 198.16.0.0/16 via 172.17.63.253</span><br><span class="line"></span><br><span class="line">ip route add network <span class="built_in">command</span> examples</span><br><span class="line">The syntax is pretty simple:</span><br><span class="line">ip route add &#123;NETWORK/MASK&#125; via &#123;GATEWAYIP&#125;</span><br><span class="line">ip route add &#123;NETWORK/MASK&#125; dev &#123;DEVICE&#125;</span><br><span class="line">ip route add default &#123;NETWORK/MASK&#125; dev &#123;DEVICE&#125;</span><br><span class="line">ip route add default &#123;NETWORK/MASK&#125; via &#123;GATEWAYIP&#125;</span><br><span class="line"></span><br><span class="line">Add a static route on Linux</span><br><span class="line">You must login as root user with the <span class="built_in">help</span> of su <span class="built_in">command</span> or <span class="built_in">sudo</span> <span class="built_in">command</span>:</span><br><span class="line">$ su -</span><br><span class="line">OR use the <span class="built_in">sudo</span> as follows:</span><br><span class="line">$ <span class="built_in">sudo</span> -i</span><br><span class="line">Once become a root user, setup a temporary route using the ip <span class="built_in">command</span>:</span><br><span class="line"><span class="comment"># ip route add 172.10.1.0/24 via 10.0.0.100 dev eth0</span></span><br><span class="line">Verify new routing table, enter:</span><br><span class="line"><span class="comment"># ip r</span></span><br><span class="line">Here is another example <span class="built_in">where</span> I am setting up route <span class="keyword">for</span> my VPN gateway:</span><br><span class="line"><span class="comment"># ip link set dev tun0 up mtu 1500</span></span><br><span class="line"><span class="comment"># ip addr add dev tun0 10.8.0.2/24 broadcast 10.8.0.255</span></span><br><span class="line"><span class="comment"># ip route add 139.59.2.125/32 via 192.168.2.254</span></span><br><span class="line"><span class="comment"># ip route add 0.0.0.0/1 via 10.8.0.1</span></span><br><span class="line"><span class="comment"># ip route add 128.0.0.0/1 via 10.8.0.1</span></span><br><span class="line">Again view route with the ip <span class="built_in">command</span>:</span><br><span class="line"><span class="comment"># ip r</span></span><br></pre></td></tr></table></figure>



<h2 id="Iptables-ç¤ºæ„å›¾"><a href="#Iptables-ç¤ºæ„å›¾" class="headerlink" title="Iptables ç¤ºæ„å›¾"></a>Iptables ç¤ºæ„å›¾</h2><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚         â”‚             PREROUTING                                                INPUT          â”‚         â”‚</span><br><span class="line">â”‚         â”‚                                                                                      â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚                                     â”‚         /â”€â”€â”€\        â”‚                    â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚ â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â” â”‚        /     \       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â” â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”œâ”€â”€â”¤â–ºâ”‚rawâ”œâ”€â–ºâ”‚conntrackâ”œâ”€â–ºâ”‚mangleâ”œâ”€â–ºâ”‚natâ”œâ”€â”¼â”€â”€â”€â”€â”€â”€â–º&lt;routing&gt;â”€â”€â”€â”€â”€â”€â”¤â–ºâ”‚mangleâ”œâ”€â–ºâ”‚filterâ”œâ”€â”¤â–ºâ”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚ â””â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”˜ â”‚        \     /       â”‚ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚                                     â”‚         \â”€â”¬â”€/        â”‚                    â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚</span><br><span class="line">â”‚         â”‚                                                    â”‚                                 â”‚         â”‚</span><br><span class="line">â”‚         â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚                                 â”‚         â”‚</span><br><span class="line">â”‚         â”‚                               â”‚          â”‚         â”‚                                 â”‚         â”‚</span><br><span class="line">â”‚         â”‚                               â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚         â”‚                                 â”‚         â”‚</span><br><span class="line">â”‚         â”‚                               â”‚ â”‚mangleâ—„â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚         â”‚</span><br><span class="line">â”‚ Network â”‚                               â”‚ â””â”€â”€â”¬â”€â”€â”€â”˜ â”‚                                           â”‚  Local  â”‚</span><br><span class="line">â”‚Interfaceâ”‚                               â”‚    â”‚     â”‚ FORWARD                                   â”‚ Process â”‚</span><br><span class="line">â”‚         â”‚                               â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â” â”‚                                  /â”€â”€â”€\    â”‚         â”‚</span><br><span class="line">â”‚         â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¤filterâ”‚ â”‚                                 /     \   â”‚         â”‚</span><br><span class="line">â”‚         â”‚               â”‚               â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚                                &lt;routing&gt;â—„â”€â”¤         â”‚</span><br><span class="line">â”‚         â”‚               â”‚               â”‚          â”‚                                 \     /   â”‚         â”‚</span><br><span class="line">â”‚         â”‚               â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  \â”€â”¬â”€/    â”‚         â”‚</span><br><span class="line">â”‚         â”‚               â”‚                                                               â”‚      â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â” â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚            â”‚    â”‚     â”€â”€â”€â”€â”€     â”‚                                          â”‚    â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚ â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â” â”‚    /     \    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ–¼â”€â”€â” â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚â—„â”€â”¼â”€â”¤natâ”‚â—„â”€â”¤mangleâ”‚â—„â”œâ”€â”€â”€&lt;reroute&gt;â”€â”€â”€â”¼â”€â”¤filterâ”‚â—„â”€â”¤natâ”‚â—„â”€â”¤mangleâ”‚â—„â”€â”¤conntrackâ”‚â—„â”€â”¤rawâ”‚ â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚ â””â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜ â”‚    \check/    â”‚ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”˜ â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â”‚                 â”‚     â”€â”€â”€â”€â”€     â”‚                                               â”‚ â”‚         â”‚</span><br><span class="line">â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚</span><br><span class="line">â”‚         â”‚     POSTROUTING                                        OUTPUT                        â”‚         â”‚</span><br><span class="line">â”‚         â”‚                                                                                      â”‚         â”‚</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure>

<h2 id="Iptables-Debug"><a href="#Iptables-Debug" class="headerlink" title="Iptables Debug"></a>Iptables Debug</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.fosslinux.com/100268/iptables-and-logging-how-to-monitor-network-traffic.htm</span></span><br><span class="line"><span class="comment"># æ‰“å¼€ iptables æ—¥å¿—</span></span><br><span class="line"><span class="built_in">sudo</span> iptables -A INPUT -j LOG --log-prefix <span class="string">&quot;iptables_input: &quot;</span> --log-level 4</span><br><span class="line"><span class="built_in">sudo</span> iptables -A OUTPUT -j LOG --log-prefix <span class="string">&quot;iptables_output: &quot;</span> --log-level 4</span><br><span class="line"><span class="built_in">sudo</span> iptables -A FORWARD -j LOG --log-prefix <span class="string">&quot;iptables_forward: &quot;</span> --log-level 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­ iptables æ—¥å¿—</span></span><br><span class="line"><span class="built_in">sudo</span> iptables -D INPUT -j LOG --log-prefix <span class="string">&quot;iptables_input: &quot;</span> --log-level 4</span><br><span class="line"><span class="built_in">sudo</span> iptables -D OUTPUT -j LOG --log-prefix <span class="string">&quot;iptables_output: &quot;</span> --log-level 4</span><br><span class="line"><span class="built_in">sudo</span> iptables -D FORWARD -j LOG --log-prefix <span class="string">&quot;iptables_forward: &quot;</span> --log-level 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ iptables æ—¥å¿—</span></span><br><span class="line">journalctl -xe -f | grep iptables</span><br></pre></td></tr></table></figure>



<h2 id="Iptables-tproxy-é€æ˜ä»£ç†æŠ€æœ¯åŸç†"><a href="#Iptables-tproxy-é€æ˜ä»£ç†æŠ€æœ¯åŸç†" class="headerlink" title="Iptables tproxy é€æ˜ä»£ç†æŠ€æœ¯åŸç†"></a>Iptables tproxy é€æ˜ä»£ç†æŠ€æœ¯åŸç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://www.bilibili.com/read/cv14088928/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»æœ¬æœºå‡ºå»çš„æ•°æ®åŒ…ä¼šç»è¿‡ OUTPUT é“¾ å’Œ POSTROUTING é“¾ã€‚</span></span><br><span class="line"><span class="comment"># ä»å¤–éƒ¨å‘å¾€æœ¬æœºçš„æ•°æ®åŒ…ä¼šç»è¿‡ PREROUTING é“¾ å’Œ INPUT é“¾ã€‚</span></span><br><span class="line"><span class="comment"># Linux å†…æ ¸æä¾›çš„ tproxyï¼ˆTransparent proxyï¼‰é€æ˜ä»£ç†èƒ½åŠ›ï¼Œtproxy åªèƒ½å·¥ä½œåœ¨ PREROUTING é“¾ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚æ•°åŠŸèƒ½ï¼š</span></span><br><span class="line"><span class="comment"># -t/--table [table]ï¼šè¡¨ç¤ºè¿™æ¡è§„åˆ™ä½œç”¨åœ¨å“ªä¸ªè¡¨ä¸Š</span></span><br><span class="line"><span class="comment"># -A/--append [chain]ï¼šè¡¨ç¤ºç»™è¿™ä¸ªé“¾æ·»åŠ ä¸€æ¡è§„åˆ™</span></span><br><span class="line"><span class="comment"># -p/--protocol [protocol]ï¼šè¡¨ç¤ºå¤„ç†å“ªä¸ªåè®®</span></span><br><span class="line"><span class="comment"># -j/--jump [target]ï¼šè¡¨ç¤ºè·³è½¬åˆ°å“ªä¸ªç›®æ ‡</span></span><br><span class="line"><span class="comment"># -d/--destination [address] è¡¨ç¤ºåŒ¹é…å¯¹åº”çš„ ipï¼ˆèŒƒå›´ï¼‰ </span></span><br><span class="line"><span class="comment"># -N/--new-chain [chain] è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªæ–°çš„é“¾</span></span><br><span class="line"><span class="comment"># -D/--deleteï¼šä»ä¸€ä¸ªé“¾ä¸Šåˆ é™¤æŒ‡å®šçš„è§„åˆ™</span></span><br><span class="line"><span class="comment"># -F/--flush [chain]ï¼šæ¸…ç©ºä¸€ä¸ªé“¾ä¸Šæ‰€æœ‰è§„åˆ™</span></span><br><span class="line"><span class="comment"># -X/--delete-chain [chain]ï¼šåˆ é™¤ä¸€ä¸ªé“¾</span></span><br><span class="line"><span class="comment"># -I/--insert [chain] [rule index] è¡¨ç¤ºæ’å…¥ä¸€æ¡è§„åˆ™åˆ°æŒ‡å®šä½ç½®ï¼Œé»˜è®¤ä¸º 1ï¼Œè¡¨ç¤ºæ’å…¥åˆ°è§„åˆ™çš„ç¬¬ä¸€æ¡ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ OUTPUT é“¾ä¸­ï¼Œç›®æ ‡ IP ä¸ºå¤–ç½‘æ—¶ï¼Œåº”å½“ç»è¿‡ tproxyã€‚ ç”±äº tproxy åªèƒ½å·¥ä½œåœ¨ PREROUTING é“¾ï¼Œä»æœ¬æœºå‘å‡ºå»çš„æ•°æ®åŒ…ä¼šç›´æ¥é€šè¿‡ OUTPUT é“¾å‡ºå»äº†ï¼Œæœ¬æœºæ•°æ®åŒ…æ²¡æœ‰æœºä¼šèµ° PREROUTING é“¾ã€‚ä¸ºäº†è®©æœ¬æœºæ•°æ®ç»è¿‡ PREROUTINGï¼Œæˆ‘ä»¬å¯ä»¥ç”¨çš„è·¯ç”±è¡¨è§£å†³ã€‚</span></span><br><span class="line">ip rule add fwmark 666 table 999                <span class="comment"># è¡¨ç¤ºè¢«æ ‡è®°ä¸º 666 çš„æ•°æ®åŒ…çš„èµ°å‘è¦æŸ¥è¡¨ 999</span></span><br><span class="line">ip route add <span class="built_in">local</span> 0.0.0.0/0 dev lo table 999   <span class="comment"># å¤§è‡´æ˜¯è¯´å¯¹äº 999 è¡¨çš„æµé‡ï¼Œéƒ½è¦å‘åˆ°æœ¬æœºçš„ PREROUTING </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“æˆ‘ä»¬ç»™ OUTPUT é“¾çš„æ•°æ®åŒ…è¿›è¡Œæ ‡è®°æ—¶ï¼Œè¿™ä¸ªæ•°æ®åŒ…ä¼šé‡æ–°æŸ¥ä¸€æ¬¡è¡¨ï¼Œå¦‚æœæˆ‘ä»¬æ ‡è®°çš„åˆšå¥½æ˜¯ 666ï¼Œé‚£è¿™ä¸ªæ•°æ®åŒ…å°±ä¼šæ ¹æ®ä¸Šé¢çš„è§„åˆ™è¿›å…¥æœ¬æœºçš„ PREROUTINGã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†æœ¬æœºçš„æ•°æ®åŒ…å‘é€çš„ tproxyã€‚ </span></span><br><span class="line"><span class="comment"># iptables ä¸­æœ‰ä¸‰ä¸ªå¸¸ç”¨çš„è¡¨ï¼Œfilterã€nat å’Œ mangleï¼Œä¸‰ä¸ªè¡¨æœ‰å„è‡ªçš„ç”¨é€”ï¼Œèƒ½é“¾çš„ä½œç”¨èŒƒå›´ä¹Ÿä¸ä¸€æ ·ï¼Œmangle è¡¨æ”¯æŒåœ¨ OUTPUT é“¾ä¸Šæ‰“æ ‡è®°ã€‚</span></span><br><span class="line"><span class="comment"># åœ¨ OUTPUT é“¾ä¸Šçš„ tcp/udp åè®®éƒ½è·³è½¬åˆ° MARK å¹¶æ ‡è®°ä¸ª 666ã€‚ æ­¤æ—¶è¢«æ ‡è®°ä¸º 666 çš„æ•°æ®åŒ…ä¼šé‡æ–°èµ°åˆ° PROROUTING é“¾ä¸Šã€‚ </span></span><br><span class="line"><span class="comment"># tproxy ä»…èƒ½å¤„ç† tcp å’Œ udpï¼Œæ‰€ä»¥è¿™é‡Œåªæ ‡è®°è¿™ä¸¤ä¸ªåè®®ã€‚ </span></span><br><span class="line"><span class="comment"># åœ¨ OUTPUT é“¾ä¸Šæ‰“æ ‡è®°å‘½ä»¤å¦‚ä¸‹ï¼š</span></span><br><span class="line">iptables -t mangle -A OUTPUT -p tcp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A OUTPUT -p udp -j MARK --set-mark 666</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šé¢çš„è§„åˆ™è™½ç„¶å®Œæˆäº†é‡å› PREROUTING çš„èƒ½åŠ›ï¼Œä½†æœ‰äº›æ•°æ®åŒ…åº”å½“ç›´æ¥ä» OUTPUT é“¾å‡ºå»ï¼Œæ¯”å¦‚è®¿é—®ç½‘å…³ç®¡ç†é¡µé¢ï¼ˆ192.168.22.1ï¼‰ï¼Œæˆ–è€…æ˜¯ NAS çš„ 192.168.22.2ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è·³è¿‡ä¸€éƒ¨åˆ†çš„æ•°æ®åŒ…é¿å…æ ‡è®°ä¸Š 666ã€‚</span></span><br><span class="line"><span class="comment"># åœ¨ OUTPUT é“¾ä¸Šï¼Œå¦‚æœæ˜¯å‘å¾€ 192.168.0.0/16 çš„æ•°æ®åŒ…ï¼Œåˆ™ç›´æ¥è¿”å›ã€‚è¿™ä¸€æ¡å‘½ä»¤è¦åœ¨å‰é¢çš„ -j MARK å‘½ä»¤ä¹‹å‰æ‰§è¡Œï¼ŒåŒ¹é…è§„åˆ™ä¼šæ ¹æ®åˆ›å»ºçš„è§„åˆ™é¡ºåºæŒ‰é¡ºåºæ‰§è¡Œã€‚ </span></span><br><span class="line">iptables -t mangle -A OUTPUT -d 192.168.0.0/16 -j RETURN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¨ç¤ºå»å¾€ é 192.168.0.0/16 çš„ tcp/udp æ•°æ®åŒ…æ ‡è®° 666</span></span><br><span class="line">iptables -t mangle -A OUTPUT -d 192.168.0.0/16 -j RETURN</span><br><span class="line">iptables -t mangle -A OUTPUT -p tcp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A OUTPUT -p udp -j MARK --set-mark 666</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰é“¾ LOCAL_DIVERT</span></span><br><span class="line">iptables -t mangle -N LOCAL_DIVERT</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 192.168.0.0/16 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -p tcp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -p udp -j MARK --set-mark 666</span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥éœ€è¦è·³è½¬åˆ°è¿™ä¸ªé“¾</span></span><br><span class="line">iptables -t mangle -A OUTPUT -j LOCAL_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“ä¸éœ€è¦ LOCAL_DIVERT æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ é™¤ï¼ˆè¦å°å¿ƒç¿¼ç¿¼ï¼‰</span></span><br><span class="line">iptables -t mangle -D OUTPUT -j LOCAL_DIVERT  <span class="comment"># é¦–å…ˆåˆ é™¤è·³è½¬ï¼ˆè°ƒç”¨ï¼‰çš„å¼•ç”¨</span></span><br><span class="line">iptables -t mangle -F LOCAL_DIVERT            <span class="comment"># ç„¶ååˆ é™¤ LOCAL_DIVERT ä¸­çš„å…¨éƒ¨è§„åˆ™</span></span><br><span class="line">iptables -t mangle -X LOCAL_DIVERT            <span class="comment"># ç„¶ååˆ é™¤ LOCAL_DIVERT è¿™ä¸ªé“¾</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥å°†æ•°æ®åŒ…é€šè¿‡ tproxy å‘ç»™ clash</span></span><br><span class="line">iptables -t mangle -A PREROUTING -p tcp -j TPROXY --on-port 7893</span><br><span class="line">iptables -t mangle -A PREROUTING -p udp -j TPROXY --on-port 7893</span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“å‰å®Œæ•´çš„ iptables å‘½ä»¤å¦‚ä¸‹ï¼š</span></span><br><span class="line">iptables -t mangle -N DIVERT</span><br><span class="line">iptables -t mangle -A DIVERT -d 192.168.0.0/16 -j RETURN       <span class="comment"># æœ¬åœ°ç½‘ç»œç›´æ¥æ”¾è¡Œï¼Œä»å¤–åˆ°å†…çš„æµé‡ä¸èµ° tproxy</span></span><br><span class="line">iptables -t mangle -A DIVERT -p tcp -j TPROXY --on-port 7893</span><br><span class="line">iptables -t mangle -A DIVERT -p udp -j TPROXY --on-port 7893</span><br><span class="line">iptables -t mangle -A PREROUTING -j DIVERT</span><br><span class="line"></span><br><span class="line">iptables -t mangle -N LOCAL_DIVERT</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 192.168.0.0/16 -j RETURN  <span class="comment"># æœ¬åœ°ç½‘ç»œç›´æ¥æ”¾è¡Œï¼Œä»å†…åˆ°å¤–çš„æµé‡ä¸èµ° tproxy</span></span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -p tcp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -p udp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A OUTPUT -j LOCAL_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸Šé¢äº§ç”Ÿäº†ä¸€ä¸ªå›ç¯ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³æ‰ï¼Œå³è®©æœ¬æœº clash å‘å‡ºæ¥çš„æ•°æ®åŒ…ç›´æ¥ä» OUTPUT é“¾å‡ºå»</span></span><br><span class="line"><span class="comment"># é€šè¿‡ gid/uid ç»•è¿‡å›ç¯ã€‚ </span></span><br><span class="line"></span><br><span class="line">grep -qw clash /etc/passwd || <span class="built_in">echo</span> <span class="string">&quot;clash:x:0:23333:::&quot;</span> &gt;&gt; /etc/passwd  <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸º clashï¼Œuid ä¸º 0ï¼Œgid ä¸º 23333 çš„ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">sudo</span> -u clash <span class="built_in">id</span>   <span class="comment"># å¯ä»¥éªŒè¯åˆ›å»ºçš„ç”¨æˆ·æ˜¯å¦æ­£å¸¸ï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> -u clash /usr/local/bin/clash -d /etc/clash  <span class="comment"># æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç”¨æˆ·å¯åŠ¨ clash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># iptables æ‰§è¡Œåœ¨ OUTPUT é“¾æ”¹ä¸ºå¦‚ä¸‹å‘½ä»¤ï¼š</span></span><br><span class="line"><span class="comment"># -m/-match è¡¨ç¤ºåŒ¹é…å¯¹åº”çš„ç­–ç•¥ï¼Œä¸Šé¢çš„å‘½ä»¤åˆ™æ˜¯åœ¨ OUTPUT é“¾ gid é 23333 çš„æ•°æ®åŒ…è·³è½¬åˆ° LOCAL_DIVERTã€‚</span></span><br><span class="line">iptables -t mangle -A OUTPUT -m owner ! --gid-owner 23333 -j LOCAL_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨ clash çš„ tproxy èƒ½åŠ›æ—¶ï¼Œéœ€è¦è®© clash æ¥ç®¡ DNS æµé‡</span></span><br><span class="line"><span class="comment"># 1.åœæ‰æœ¬åœ°çš„ DNS æœåŠ¡ï¼Œå°† clash çš„ DNS æœåŠ¡ç«¯å£æ”¹ä¸º 53 2.å°† DNS æŸ¥è¯¢æ•°æ®åŒ…è½¬å‘åˆ° clash</span></span><br><span class="line">iptables -t nat -N LOCAL_DNS_DIVERT</span><br><span class="line">iptables -t nat -A LOCAL_DNS_DIVERT -p udp --dport 53 -j REDIRECT --to-ports 1053  <span class="comment"># 1053 æ˜¯åœ¨ clash ä¸Šè®¾ç½®çš„ DNS æœåŠ¡ç«¯å£</span></span><br><span class="line">iptables -t nat -I OUTPUT -m owner ! --gid-owner 23333 -j LOCAL_DNS_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»•è¿‡æ›´å¤šå†…ç½‘ IP æ®µã€‚å‘å¾€ 127.0.0.1:1053 çš„ DNS æŸ¥è¯¢æ•°æ®åŒ…ä¼šé€šè¿‡ OUTPUT é“¾å›åˆ° PREROUTING æœ€åè¿›å…¥åˆ° tproxyã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ OUTPUT é“¾è·³è¿‡å»</span></span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 127.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 127.0.0.0/8 -j RETURN <span class="comment"># å›æ¥æ•°æ®åŒ…ä»ç„¶ç»è¿‡ PREROUTINGï¼ŒåŒæ ·éœ€è¦è·³è¿‡</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ‘ä»¬è¿˜æœ‰æ›´å¤šçš„å†…ç½‘/ç‰¹æ®Š IP æ®µéœ€è¦ç›´æ¥ RETURNï¼Œå®Œæ•´åˆ—è¡¨å¦‚ä¸‹ï¼š</span></span><br><span class="line">100.64.0.0/10</span><br><span class="line">127.0.0.0/8</span><br><span class="line">169.254.0.0/16</span><br><span class="line">192.0.0.0/24</span><br><span class="line">224.0.0.0/4</span><br><span class="line">240.0.0.0/4</span><br><span class="line">255.255.255.255/32</span><br><span class="line">192.168.0.0/16</span><br><span class="line">172.16.0.0/12</span><br><span class="line">10.0.0.0/8</span><br></pre></td></tr></table></figure>

<p><strong>å®Œæ•´é…ç½®è®°å½•</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># https://gist.github.com/DianQK/25cf82bff5136068b98575adef598f82#file-iptables_1-sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clash é…ç½®</span></span><br><span class="line">grep -qw clash /etc/passwd || <span class="built_in">echo</span> <span class="string">&quot;clash:x:0:23333:::&quot;</span> &gt;&gt; /etc/passwd  <span class="comment"># åˆ›å»ºä¸€ä¸ªåä¸º clashï¼Œuid ä¸º 0ï¼Œgid ä¸º 23333 çš„ç”¨æˆ·</span></span><br><span class="line"><span class="built_in">sudo</span> -u clash <span class="built_in">id</span>   <span class="comment"># å¯ä»¥éªŒè¯åˆ›å»ºçš„ç”¨æˆ·æ˜¯å¦æ­£å¸¸ï¼š</span></span><br><span class="line"><span class="built_in">sudo</span> -u clash /usr/local/bin/clash -d /etc/clash  <span class="comment"># æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç”¨æˆ·å¯åŠ¨ clash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt; config.yaml</span></span><br><span class="line"><span class="string">tproxy-port: 7893</span></span><br><span class="line"><span class="string">dns:</span></span><br><span class="line"><span class="string">  enable: true</span></span><br><span class="line"><span class="string">  enhanced-mode: fake-ip</span></span><br><span class="line"><span class="string">  fake-ip-range: 198.16.0.1/16</span></span><br><span class="line"><span class="string">  listen: 0.0.0.0:1053</span></span><br><span class="line"><span class="string">  nameserver:</span></span><br><span class="line"><span class="string">    - 8.8.8.8:53</span></span><br><span class="line"><span class="string">  fake-ip-filter:</span></span><br><span class="line"><span class="string">    - 163.com</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·³è¿‡æ¥è‡ªæœåŠ¡ç«¯å£çš„æµé‡</span></span><br><span class="line"><span class="comment"># https web server</span></span><br><span class="line">iptables -t mangle -I OUTPUT -p tcp --sport 80 -j RETURN</span><br><span class="line">iptables -t mangle -I OUTPUT -p tcp --sport 443 -j RETURN</span><br><span class="line">iptables -t mangle -I OUTPUT -p tcp --sport 22 -j RETURN</span><br><span class="line">iptables -t mangle -I OUTPUT -p tcp --sport 1443 -j RETURN</span><br><span class="line">iptables -t mangle -I OUTPUT -p udp --sport 1443 -j RETURN</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå…¥ç«™è§„åˆ™</span></span><br><span class="line">iptables -t mangle -N DIVERT</span><br><span class="line">iptables -t mangle -A DIVERT -d 8.219.56.209/32 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 100.64.0.0/10 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 127.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 169.254.0.0/16 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 192.0.0.0/24 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 240.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 255.255.255.255/32 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 192.168.0.0/16 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 172.16.0.0/12 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -d 10.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t mangle -A DIVERT -p tcp -j TPROXY --on-port 7893</span><br><span class="line">iptables -t mangle -A DIVERT -p udp -j TPROXY --on-port 7893</span><br><span class="line">iptables -t mangle -A PREROUTING -j DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºå‡ºç«™è§„åˆ™</span></span><br><span class="line">ip rule add fwmark 666 table 999</span><br><span class="line">ip route add <span class="built_in">local</span> 0.0.0.0/0 dev lo table 999</span><br><span class="line">iptables -t mangle -N LOCAL_DIVERT</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 8.219.56.209/32 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 100.64.0.0/10 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 127.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 169.254.0.0/16 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 192.0.0.0/24 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 240.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 255.255.255.255/32 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 192.168.0.0/16 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 172.16.0.0/12 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -d 10.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -p tcp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A LOCAL_DIVERT -p udp -j MARK --set-mark 666</span><br><span class="line">iptables -t mangle -A OUTPUT -m owner ! --gid-owner 23333 -j LOCAL_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»º DNS è§„åˆ™</span></span><br><span class="line">iptables -t nat -N LOCAL_DNS_DIVERT</span><br><span class="line">iptables -t nat -A LOCAL_DNS_DIVERT -p udp --dport 53 -j REDIRECT --to-ports 1053  <span class="comment"># 1053 æ˜¯åœ¨ clash ä¸Šè®¾ç½®çš„ DNS æœåŠ¡ç«¯å£</span></span><br><span class="line">iptables -t nat -I OUTPUT -m owner ! --gid-owner 23333 -j LOCAL_DNS_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…³é—­ å‡ºç«™ è§„åˆ™</span></span><br><span class="line">iptables -t mangle -D OUTPUT -m owner ! --gid-owner 23333 -j LOCAL_DIVERT</span><br><span class="line">iptables -t mangle -F LOCAL_DIVERT</span><br><span class="line">iptables -t mangle -X LOCAL_DIVERT</span><br><span class="line"><span class="comment"># å…³é—­æ¸…ç©º å…¥ç«™ è§„åˆ™</span></span><br><span class="line">iptables -t mangle -D PREROUTING -j DIVERT</span><br><span class="line">iptables -t mangle -F DIVERT</span><br><span class="line">iptables -t mangle -X DIVERT</span><br><span class="line"><span class="comment"># å…³é—­æ¸…ç©º DNS è§„åˆ™</span></span><br><span class="line">iptables -t nat -D OUTPUT -m owner ! --gid-owner 23333 -j LOCAL_DNS_DIVERT</span><br><span class="line">iptables -t nat -F LOCAL_DNS_DIVERT</span><br><span class="line">iptables -t nat -X LOCAL_DNS_DIVERT</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¡¥å……ï¼šè½¬å‘ä»å±€åŸŸç½‘æ”¶åˆ°çš„æ‰€æœ‰ DNS æŸ¥è¯¢æµé‡åˆ° 1053 ç«¯å£</span></span><br><span class="line">iptables -t nat -I PREROUTING -p udp --dport 53 -j REDIRECT --to 1053</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤</span></span><br><span class="line">iptables -t nat -D PREROUTING -p udp --dport 53 -j REDIRECT --to 1053</span><br></pre></td></tr></table></figure>

<h3 id="ç«¯å£å¤ç”¨"><a href="#ç«¯å£å¤ç”¨" class="headerlink" title="ç«¯å£å¤ç”¨"></a>ç«¯å£å¤ç”¨</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/261429.html">https://www.freebuf.com/articles/web/261429.html</a></li>
<li><a target="_blank" rel="noopener" href="https://saucer-man.com/operation_and_maintenance/586.html">https://saucer-man.com/operation_and_maintenance/586.html</a></li>
<li><a target="_blank" rel="noopener" href="https://idiotc4t.com/defense-evasion/shadowmove-emersion-and-think">https://idiotc4t.com/defense-evasion/shadowmove-emersion-and-think</a></li>
<li><a target="_blank" rel="noopener" href="https://www.usenix.org/system/files/sec20summer_niakanlahiji_prepub.pdf">https://www.usenix.org/system/files/sec20summer_niakanlahiji_prepub.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.vackbot.com/archives/%E4%BB%A3%E7%90%86%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8%E5%9C%A8%E5%90%8E%E6%B8%97%E9%80%8F%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%8E%A2%E7%A9%B6">https://blog.vackbot.com/archives/%E4%BB%A3%E7%90%86%E7%AB%AF%E5%8F%A3%E5%A4%8D%E7%94%A8%E5%9C%A8%E5%90%8E%E6%B8%97%E9%80%8F%E5%9C%BA%E6%99%AF%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E6%8E%A2%E7%A9%B6</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">åœ¨åæ¸—é€åœºæ™¯ä¸­ï¼Œä»£ç†å‡ ä¹æ˜¯ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ï¼Œå¯¹äºå¤šå±‚ç½‘ç»œæ¶æ„çš„å¤æ‚å†…ç½‘ç¯å¢ƒè€Œè¨€ï¼Œå¤šçº§ä»£ç†ã€å¤šåè®®ä»£ç†ã€ç«¯å£å¤ç”¨ç­‰ä»£ç†åŠŸèƒ½ä¾¿å°¤ä¸ºé‡è¦ï¼Œæœ¬æ–‡å°†åˆ†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†é€æ­¥ä»‹ç»ï¼š</span><br><span class="line"></span><br><span class="line">å¸¸è§ä»£ç†çš„æ–¹å¼</span><br><span class="line">ä»£ç†ç«¯å£å¤ç”¨ç ”ç©¶</span><br><span class="line">åŸºäºå·²æœ‰æœåŠ¡çš„ç«¯å£å¤ç”¨æ–¹å¼</span><br><span class="line">å¸¸è§ä»£ç†æ–¹å¼</span><br><span class="line">åå‘ä»£ç†</span><br><span class="line">åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æŒ‡çš„æ˜¯ç”±ç›®æ ‡æœåŠ¡å™¨ä¸»åŠ¨åƒå®¢æˆ·ç«¯å‘èµ·è¿æ¥è¯·æ±‚çš„ä»£ç†æ¨¡å¼ï¼Œè¿™ç§ä»£ç†æ¨¡å¼é€šå¸¸æ˜¯æ”»é˜²å®æˆ˜ä¸­å®Œæˆè¾¹ç•Œçªç ´åçš„ä»£ç†æ–¹å¼çš„ä¼˜é€‰é¡¹ï¼Œç¨³å®šæ€§ç›¸å¯¹æ›´ä½³ã€‚ç¼ºç‚¹æ˜¯æœåŠ¡å™¨éœ€è¦å…·å¤‡å‡ºç½‘èƒ½åŠ›ï¼Œåœ¨æµé‡ä¾§ä¼šæœ‰ä¸»åŠ¨å¤–è¿çš„ç—•è¿¹ï¼Œå¦‚æœä½¿ç”¨çš„ä»£ç†å·¥å…·å­˜åœ¨æµé‡ä¾§ç‰¹å¾å®¹æ˜“è¢«æ€åŠ¿æ„ŸçŸ¥ç­‰è®¾å¤‡å‘ç°ã€‚åˆ—ä¸¾å‡ ä¸ªåä»£å·¥å…·ï¼š</span><br><span class="line">1ã€frp</span><br><span class="line">https://github.com/fatedier/frp.git</span><br><span class="line"></span><br><span class="line">2ã€earthworm</span><br><span class="line">https://github.com/idlefire/ew.git</span><br><span class="line"></span><br><span class="line">3ã€ngrok</span><br><span class="line">https://github.com/inconshreveable/ngrok.git</span><br><span class="line"></span><br><span class="line">4ã€nps</span><br><span class="line">https://github.com/ehang-io/nps</span><br><span class="line"></span><br><span class="line">5ã€erfrp</span><br><span class="line">https://github.com/Goqi/Erfrp</span><br><span class="line"></span><br><span class="line">æ­£å‘ä»£ç†</span><br><span class="line">æ­£å‘ä»£ç†ï¼ˆForward Proxyï¼‰æ˜¯æŒ‡ç”±å®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œå¹¶ç”±ä»£ç†æœåŠ¡å™¨å‘ç›®æ ‡è½¬å‘çš„ä»£ç†æ–¹å¼ï¼Œè¿™ç§ä»£ç†æ¨¡å¼æ˜¯ç§‘å­¦ä¸Šç½‘å¸¸ç”¨çš„ä»£ç†æ–¹å¼ã€‚åœ¨æ”»é˜²å®æˆ˜ä¸­ï¼Œç”±äºç›®æ ‡ä¸»æœºæœåŠ¡å™¨é€šå¸¸åœ¨å†…ç½‘ç¯å¢ƒï¼ŒæœåŠ¡ç”±ä¾‹å¦‚nginxç­‰æœåŠ¡å°†æœåŠ¡ç«¯å£ä»£ç†æ˜ å°„å‡ºå»ï¼Œå› æ­¤åœ¨æœåŠ¡ä¸Šä¸»åŠ¨åˆ›å»ºçš„ä»£ç†ç›‘å¬æœåŠ¡å¾ˆéš¾é€šè¿‡å…¬ç½‘è®¿é—®åˆ°ã€‚é€šå¸¸åšæ³•æ˜¯å¤ç”¨webæœåŠ¡ï¼Œé€šè¿‡å¯¹åº”çš„å¼€å‘è¯­è¨€å†™ä»£ç†çš„æœåŠ¡ï¼Œå†é€šè¿‡æ­£å‘ä»£ç†å®ç°è¿æ¥ï¼Œè¿™ç§æ–¹å¼é€šå¸¸ç¨³å®šæ€§å’Œé€Ÿåº¦ç›¸å¯¹è¾ƒå·®ï¼Œé€šå¸¸åœ¨æœåŠ¡å™¨æ— æ³•å‡ºç½‘çš„æƒ…å†µä¸‹é€‰æ‹©ã€‚åˆ—ä¸¾ä¸¤ä¸ªwebProxyï¼š</span><br><span class="line"></span><br><span class="line">1ã€reGeorg</span><br><span class="line">https://github.com/sensepost/reGeorg.git</span><br><span class="line"></span><br><span class="line">2ã€Neo-reGeorg</span><br><span class="line">https://github.com/L-codes/Neo-reGeorg</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ç«¯å£å¤ç”¨</span><br><span class="line">ç«¯å£å¤ç”¨ï¼Œä¹Ÿè¢«ç§°ä¸ºç«¯å£å…±äº«ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€å°ä¸»æœºä¸Šï¼Œå…è®¸å¤šä¸ªç½‘ç»œåº”ç”¨ç¨‹åºä½¿ç”¨åŒä¸€ä¸ªç½‘ç»œç«¯å£çš„æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯å¯ä»¥æœ‰æ•ˆåœ°æé«˜ç½‘ç»œèµ„æºçš„åˆ©ç”¨ç‡ï¼Œé¿å…ç«¯å£èµ„æºçš„æµªè´¹ã€‚åœ¨ç½‘ç»œå®‰å…¨åœºæ™¯ä¸‹çš„ç«¯å£å¤ç”¨ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†éšè—æ”»å‡»ç—•è¿¹å’Œè¿›è¡Œé˜²ç«å¢™bypassã€‚</span><br><span class="line"></span><br><span class="line">é‡å®šå‘æ–¹å¼å®ç°</span><br><span class="line">ä½¿ç”¨åœºæ™¯é€šå¸¸ä¸ºé˜²ç«å¢™é™åˆ¶äº†è®¿é—®ç«¯å£ã€‚é€šè¿‡ç³»ç»Ÿçš„æµé‡è½¬å‘åŠŸèƒ½å®ç°ï¼ŒLinuxä¸‹é€šè¿‡iptableså®ç°æµé‡è½¬å‘ã€‚å‡è®¾åŸæœ¬æœåŠ¡å™¨å¼€æ”¾äº†80ç«¯å£ï¼Œæˆ‘ä»¬è¦å°†eth0ç½‘å¡çš„80ç«¯å£æµé‡å…¨éƒ¨è½¬å‘åˆ°æœ¬åœ°ä»£ç†ç›‘å¬ç«¯å£8080ã€‚</span><br><span class="line"></span><br><span class="line">iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j REDIRECT --to-port 8080</span><br><span class="line">å†ç”±ç›‘å¬çš„ä»£ç†æœåŠ¡åšæµé‡åˆ†æµå¤„ç†ï¼Œå°†å¸¦æœ‰ä»£ç†ç‰¹å¾çš„æµé‡ä¿ç•™ä¸‹æ¥ï¼Œç›®æ ‡æµé‡å‘é€å›å¯¹åº”æœåŠ¡ï¼Œä¿è¯åŸæœ¬æœåŠ¡æ­£å¸¸è¿›è¡Œã€‚æ¯”å¦‚å¦‚æœæˆ‘ä»¬åŠ«æŒè½¬å‘çš„æœåŠ¡ä¸ºwebæœåŠ¡ï¼Œè€Œæˆ‘ä»¬çš„ä»£ç†åè®®ä½¿ç”¨çš„æ˜¯socks5åè®®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åè®®å¤´è¿›è¡Œåˆ¤æ–­å’Œè¿‡æ»¤ã€‚</span><br><span class="line"></span><br><span class="line">å¯¹äºwindowsè€Œè¨€ï¼Œéç³»ç»ŸæœåŠ¡ï¼Œæ¯”å¦‚é‡å®šå‘ Windows ä¸Šçš„ Apache çš„ 8080 ç«¯å£åˆ° 1080 ç«¯å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ IpNat è¿›è¡Œè½¬å‘ã€‚</span><br><span class="line"></span><br><span class="line"># è½¬å‘å‘½ä»¤ </span><br><span class="line">netsh interface portproxy add v4tov4 listenport=æºç«¯å£ listenaddress=æºIP connectport=ç›®æ ‡ç«¯å£ connectaddress=ç›®æ ‡IP</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹è½¬å‘è§„åˆ™</span><br><span class="line">netsh interface portproxy show all</span><br><span class="line"></span><br><span class="line"># åˆ é™¤è§„åˆ™</span><br><span class="line">netsh interface portproxy delete v4tov4 listenport=æºç«¯å£ listenaddress=æºIP</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<div class="article-footer reveal fs14"><section id="license"><div class="header"><span>è®¸å¯åè®®</span></div><div class="body"><p>æœ¬æ–‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></section></div>

</article>

<div class="related-wrap reveal" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">è¾ƒæ–°æ–‡ç« </div><a href="/2024/01/01/basetools/Atlassian-Confluence/">Atlassian-Confluenceä¸JIRAå®‰è£…é…ç½®å…¨æ”»ç•¥</a></div><div class="item" id="next"><div class="note">è¾ƒæ—©æ–‡ç« </div><a href="/2024/01/01/basetools/OneKeyInstall/">ç¼–ç¨‹ç¯å¢ƒä¸€é”®å®‰è£…æŒ‡å— | Windowsä¸Linuxå…¨å¹³å°è¦†ç›–</a></div></section></div>








      
<footer class="page-footer reveal fs12"><hr><div class="text"><p>æœ¬ç«™ç”± <a href="/">@anonymity</a> ä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar">Stellar</a> ä¸»é¢˜åˆ›å»ºã€‚<br>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
</div></footer>

      <div class='float-panel mobile-only blur' style='display:none'>
  <button type='button' class='sidebar-toggle mobile' onclick='sidebar.toggle()'>
    <svg class="icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15301"><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 2.3 26.8 24.6 47.5 51.6 47.6h416.5v4z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15302"></path><path d="M566.407 808.3c26.9-0.1 49.3-20.8 51.6-47.6-1.9-27.7-23.9-49.7-51.6-51.6h-412.6c-28.2-1.4-52.6 19.5-55.5 47.6 1.9 27.7 23.9 49.7 51.6 51.6h416.5z m309.3-249.9c26.9-0.1 49.3-20.8 51.6-47.6-2.2-26.8-24.6-47.5-51.6-47.6h-721.9c-27.7-2.8-52.5 17.4-55.3 45.1-0.1 0.8-0.1 1.7-0.2 2.5 0.9 27.2 23.6 48.5 50.7 47.6H875.707z m-103.1-245.9c26.9-0.1 49.3-20.8 51.6-47.6-0.4-28.3-23.2-51.1-51.5-51.6h-618.9c-29.5-1.1-54.3 21.9-55.5 51.4v0.2c1.4 27.8 25.2 49.2 53 47.8 0.8 0 1.7-0.1 2.5-0.2h618.8z" p-id="15303"></path></svg>
  </button>
</div>

    </div>
  </div>
  <div class='scripts'>
    <script type="text/javascript">
  const stellar = {
    // æ‡’åŠ è½½ css https://github.com/filamentgroup/loadCSS
    loadCSS: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    // ä» butterfly å’Œ volantis è·å¾—çµæ„Ÿ
    loadScript: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = stellar.config.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // é»˜è®¤å¼‚æ­¥ï¼Œå¦‚æœéœ€è¦åŒæ­¥ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ {} å³å¯
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    // https://github.com/jerryc127/hexo-theme-butterfly
    jQuery: (fn) => {
      if (typeof jQuery === 'undefined') {
        stellar.loadScript(stellar.plugins.jQuery).then(fn)
      } else {
        fn()
      }
    }
  };
  stellar.version = '1.19.0';
  stellar.github = 'https://github.com/xaoxuu/hexo-theme-stellar/tree/1.19.0';
  stellar.config = {
    date_suffix: {
      just: 'åˆšåˆš',
      min: 'åˆ†é’Ÿå‰',
      hour: 'å°æ—¶å‰',
      day: 'å¤©å‰',
      month: 'ä¸ªæœˆå‰',
    },
    root : '/',
  };

  // required plugins (only load if needs)
  stellar.plugins = {
    jQuery: 'https://gcore.jsdelivr.net/npm/jquery@3.6.2/dist/jquery.min.js'
  };

  if ('local_search') {
    stellar.search = {};
    stellar.search.service = 'local_search';
    if (stellar.search.service == 'local_search') {
      let service_obj = Object.assign({}, {"field":"all","path":"/search.json","content":true,"codeblock":true,"sort":"-date"});
      stellar.search[stellar.search.service] = service_obj;
    }
  }

  // stellar js
  stellar.plugins.stellar = Object.assign({"sites":"/js/plugins/sites.js","friends":"/js/plugins/friends.js","ghinfo":"/js/plugins/ghinfo.js","timeline":"/js/plugins/timeline.js","linkcard":"/js/plugins/linkcard.js","fcircle":"/js/plugins/fcircle.js","weibo":"/js/plugins/weibo.js"});

  stellar.plugins.marked = Object.assign("https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js");
  // optional plugins
  if ('true' == 'true') {
    stellar.plugins.lazyload = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/vanilla-lazyload@17.8.3/dist/lazyload.min.js","transition":"blur"});
  }
  if ('true' == 'true') {
    stellar.plugins.swiper = Object.assign({"enable":true,"css":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.css","js":"https://unpkg.com/swiper@8.4.5/swiper-bundle.min.js"});
  }
  if ('' == 'true') {
    stellar.plugins.scrollreveal = Object.assign({"enable":null,"js":"https://gcore.jsdelivr.net/npm/scrollreveal@4.0.9/dist/scrollreveal.min.js","distance":"8px","duration":500,"interval":100,"scale":1});
  }
  if ('true' == 'true') {
    stellar.plugins.preload = Object.assign({"enable":true,"service":"flying_pages","instant_page":"https://gcore.jsdelivr.net/gh/volantis-x/cdn-volantis@4.1.2/js/instant_page.js","flying_pages":"https://gcore.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.fancybox = Object.assign({"enable":true,"js":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.umd.js","css":"https://gcore.jsdelivr.net/npm/@fancyapps/ui@4.0/dist/fancybox.css","selector":".swiper-slide img"});
  }
  if ('false' == 'true') {
    stellar.plugins.heti = Object.assign({"enable":false,"css":"https://unpkg.com/heti@0.9.2/umd/heti.min.css","js":"https://unpkg.com/heti@0.9.2/umd/heti-addon.min.js"});
  }
  if ('true' == 'true') {
    stellar.plugins.copycode = Object.assign({"enable":true,"js":"/js/plugins/copycode.js","default_text":"Copy","success_text":"Copied"});
  }
</script>

<!-- required -->

  
<script src="/js/main.js" async></script>



<!-- optional -->



<!-- inject -->


  </div>
</body>
</html>
